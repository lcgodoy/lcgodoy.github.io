{
  "hash": "2585fc3fb5882b51983ccbe1651ca696",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: |\n  Spatiotemporal Analysis of Tuberculosis using Hausdorff--Gaussian Processes\nsubtitle: |\n  Available at [lcgodoy.me/slides/2024-cobal/](https://lcgodoy.me/slides/2024-cobal/)\nauthor:\n  - name: Lucas da Cunha Godoy\n    orcid: 0000-0003-4265-972X\n    email: |\n      ldcgodoy@ucsc.com\n    affiliations: EEB Department, UCSC\ninstitute: VII COBAL \\& XVII EBEB -- UFMG\ndate: 2024-12-05\nbibliography: references.bib\ncsl: styles/asa.csl\ntitle-slide-attributes:\n  data-background-image: qr-code-end.png\n  data-background-size: 30%\n  data-background-position: 90% 90%\nformat:\n  revealjs:\n    theme: [styles/cobal.scss]\n    filters: [styles/appendix.lua]\n    embed-resources: true\n    self-contained-math: true\n    toc: true\n    toc-depth: 1\n    smaller: false\n    slide-number: c/t\n    navigation-mode: linear\n    html-math-method:\n      method: mathjax\n      url: \"https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML\"\n---\n\n::: {.cell}\n\n:::\n\n\n\n\n# Introduction {.section_slide visibility=\"uncounted\"}\n\n\\newcommand\\indicator{1\\kern-0.25em\\text{l}}\n\\newcommand\\REALS{1\\kern-0.2em\\text{R}}\n\\newcommand\\E{\\mathbb{E}}\n\\newcommand\\dd{\\mathrm{d}}\n\n\n\n::: {.cell}\n\n:::\n\n\n\n## Too many slides...\n\n![](kalu.jpg){fig-align=\"center\"}\n\n## Tuberculosis in context\n\n- [Mortality]{.important2}: Tuberculosis (TB) remains a major global health\n  threat, [second in infectious disease mortality]{.important} only to\n  COVID-19. Despite being among UN's development goals in the [Millennium\n  Declaration in 2000]{.important}.\n  \n- [Rio Grande do Sul (RS)]{.important2} reported significantly [higher\n  incidence]{.important} than the national [average]{.important} in 2021, with\n  the eastern region even more affected.\n\n- [Dependence]{.important2}: Studies demonstrate [strong spatial\n  dependence]{.important} of TB infections in Brazil, but temporal and\n  spatiotemporal structures have been largely overlooked.\n\n- [Risk Factors]{.important2}: TB risk factors include densely populated areas,\n  poverty, substance abuse, and incarceration [@cortez2021tuberculosis].\n\n\n## Spatiotemporal (SPT) models for areal data\n\n- [Spatial models]{.important2}: CAR [@besag1974spatial], ICAR,\n  [BYM]{.important} [@besag1991bayesian], [DAGAR]{.important}\n  [@datta2019spatial], RENeGe [@cruz2023inducing].\n\n- [Nonseparable SPT models]{.important2} are more [complex]{.important} as they\n  consider that the spatial and temporal correlations might be\n  [intertwined]{.important} [@cressie2015statistics, pg. 309--321].\n\n- [Separable models]{.important2} one way to look at these models is as\n  [multivariate spatial processes]{.important} [@macnab2022bayesian]. \n  \n- [Advantages of separable models]{.important2}: [Computational\n  efficiency]{.important} \\& [positive-definiteness]{.important} of the\n  covariance function.\n\n## Proposed methodology \\& Objectives\n\n- [Hausdorff--Gaussian Process (HGP)]{.important2}: we propose using the newly\n  developed HGP for the spatial portion of the model [@godoy2024statistical].\n\n- [Reliable incidence estimates]{.important2}:\n  - Smaller municipalities benefit from [borrowed strength]{.important} from\n    neighbors, improving estimate reliability.\n  - Results enable the calculation of standardized incidence ratios to [pinpoint\n    high-risk areas]{.important}.\n\n- [Forecasting]{.important2}: Predicted TB incidence rates one year ahead offer\n  crucial insights for [proactive public health planning]{.important}.\n\n\n# Hausdorff--Gaussian Process (HGP) {.section_slide visibility=\"uncounted\"}\n\n## Preliminaries {.center}\n\n- [Areal]{.important} spatial units [are]{.important} (closed and bounded)\n  [sets]{.important}.\n\n- We need to generalize distance between points to [distance between\n  sets]{.important}.\n    \n- Ideally, this distance should: \n  1. [Take into account]{.important} the [shape, size, and\n     orientation]{.important} of spatial sample units.\n  2. Be [\"spatially interpretable\"]{.important}.\n\n\n## Distances between sets\n\n<!-- - [Metric space]{.important2}: $(D, d)$, where $D$ is a spatial region of -->\n<!--   interest. -->\n\n- [Distance between a point and a set]{.important2}: $d(x, A) = \\inf_{a \\in A}\n  d(x, a)$, where $d(x, y)$ is the distance between any two elements $x, y \\in\n  D$\n\n- [Directed Hausdorff \\& Hausdorff distance]{.important2}: $${\\vec h}(A, B) =\n  \\sup_{a \\in A} d(a, B) \\quad \\text{and} \\quad h(A, B) = \\max \\left \\{\n  \\vec{h}(A, B), \\vec{h}(B, A) \\right \\}$$\n\n\n\n::: {.cell layout-ncol=\"3\"}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/haus-dist-1.png){width=960}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/haus-dist-2.png){width=960}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/haus-dist-3.png){width=960}\n:::\n:::\n\n\n\n:::{.notes}\n\n- [Symmetric Hausdorff distance]{.important2}: the greater of the two directed\n  Hausdorff distances.\n\n- Note that if $A$ and $B$ are both singletons, then $h(A, B) = d(A, B)$.\n\nMeric Properties: (1) Symmetry: $d(x, y) = d(y, x)$; (2) Nonnegativeness: $d(x,\ny) \\geq 0$ and $d(x, x) = 0$; (3)Positiveness: $d(x, y) = 0 \\implies x = y$; (4)\nTriangle inequality: $d(x, y) \\leq d(x, z) + d(z, y)$\n\n- Metric on $D \\setminus \\varnothing$\n\n- The Hausdorff distance ability to account for spatial units' [shapes, sizes\n  and orientation]{.important}[@min2007extended] renders it an interesting tool\n  to achieve our goals.\n\n- Moreover, it can [distinguish]{.important} between [overlapping, nested, and\n  disjointed regions]{.important}.\n\n- In the figure: (1) The dashed lines denote the Hausdorff distances; (2) The\n  infimum distance between to sets is zero for the three cases; (3) Distance\n  between centroids is the same for the first two figures.\n\n:::\n\n\n## The HGP\n\n- [General spatial model]{.important2}: $\\{ Z(\\mathbf{s}) \\; : \\; \\mathbf{s} \\in\n  \\mathcal{B}(D) \\}$.\n\n\n- [Index set]{.important2}: $\\mathcal{B}(D)$ represents the [closed and\n  bounded]{.important} subsets of $D \\subset \\mathbb{R}^2$.\n\n\n- [Assumption]{.important2}: The [HGP]{.important} assumes $Z(\\mathbf{s})$ to be\n  an [isotropic]{.important} Gaussian Process such that its [spatial\n  correlation function]{.important} depends on the [Hausdorff\n  distance]{.important}.\n\n\n- [Powered Exponential Correlation (PEC) function]{.important2}: $r(h) =\n  \\exp\\left \\{ - \\frac{h^{\\nu}}{\\phi^{\\nu}}\\right \\},$ where $h$ denotes the\n  [Hausdorff distance]{.important} between $\\mathbf{s}_1, \\mathbf{s}_2 \\in\n  \\mathcal{B}(D)$.\n\n\n:::{.notes}\n\n- Ideally, we want bounded, compact, and non-empty sets for the Hausdorff\n  distance to be a metric..\n\n- In $\\mathbb{R}^2$, a compact subset is bounded.\n\n- empty is a subset of any set -> it is bounded bc a subset of a bounded set is\n  bounded itself.\n\n- Mean and SD functions can be informed by covariates.\n\n- The ensure the validity of the process, the function $r(\\cdot)$ must be\n  positive definite.\n\n- Complex functional parametric space. \n\n- Inference is simplified (or possible) by assuming parametric forms to those\n  functions.\n\n\n- Mean and SD functions can be informed by covariates.\n\n- The ensure the validity of the process, the function $r(\\cdot)$ must be\n  positive definite.\n\n- Complex functional parametric space. \n\n- Inference is simplified (or possible) by assuming parametric forms to those\n  functions.\n\n- The SD function allows the HGP to accommodate both [homoscedastic and\n  heteroscedastic scenarios]{.important}.\n\n:::\n\n\n# Tuberculosis spatiotemporal modeling {.section_slide visibility=\"uncounted\"}\n\n\n## Data \\& Model\n\n- [Sample units]{.important2}: 54 municipalities, across 11 years (2011 to\n  2021). We use [2022]{.important} to [assess]{.important} the quality of\n  [predictions]{.important}.\n\n- [Number of TB cases]{.important2}: $Y_t(\\mathbf{s}_i)$ at location\n  $\\mathbf{s}_i$ and time $t$.\n\n- [Population]{.important2}: $P_t(\\mathbf{s}_i)$.\n\n- Five covariates and two way [interactions with presence of\n  prison]{.important} (except IDESE).\n\n$$\\begin{aligned}\n& (Y_t(\\mathbf{s}_i) \\mid \\mathbf{X}_{t}(\\mathbf{s}_i), Z(\\mathbf{s}_i, t))\n  \\overset{{\\rm ind}}{\\sim}\n  \\text{Poisson}(P_t(\\mathbf{s}_i) \\mu_{it}) \\\\\n& \\log(\\mu_{it}) = \\alpha + \\mathbf{X}^\\top_{t}(\\mathbf{s}_i) \\beta + Z(\\mathbf{s}_i, t)\n\\end{aligned}$$\n\n:::{.notes}\n\n- $\\mu_it$: rate\n\n- A weakly informative Beta prior with mode at 0.75 and standard deviation\n  around 0.22.\n\n- Prior sensitivity using Importance Sampling and power-scaling.\n\n:::\n\n## Priors\n\n- We assume $Z(\\mathbf{s}, t)$ is a separable zero-mean Gaussian model such that\n  its [SPT covariance]{.important} matrix is the [kronecker product]{.important}\n  between a spatial covariance ([HGP]{.important}, BYM, \\& DAGAR) and a temporal\n  correlation ([$\\mathrm{AR}(1)$]{.important}).\n\n\n- [HGP spatial dependence]{.important2}: $\\rho \\sim \\mathrm{Exp}(a_\\rho)$, where\n  $a_{\\rho} = - \\log(p_{\\rho}) / \\rho_0$.  $a_\\rho$ is chosen such that\n  $\\mathbb{P}(\\rho > \\rho_0) = p_\\rho$.\n\n\n- [Smoothness \\& marginal SD]{.important2}: $\\nu \\sim \\mathrm{Beta}(2.5, 1.5)$\n  ([mode at $0.75$]{.important}) \\& $\\sigma \\sim t_{+}(3)$.\n\n\n- [Temporal dependence]{.important2}: PC prior [@sorbye2017penalised] where\n  $\\mathbb{P}(\\lvert \\psi \\rvert > 0.8) = 0.1$.\n\n\n- [Intercept \\& regression coefficients]{.important2}: $\\alpha$ (i.e.,\n  $\\pi(\\alpha) \\propto 1$) \\& $\\boldsymbol{\\beta} \\sim \\mathcal{N}(\\mathbf{0},\n  10 \\mathbf{I})$\n\n\n:::{.notes}\n\n- For $\\rho$, the prior is inspired in penalized complexity priors. A\n  conservative, but reasonable, choice for its hyperparameter is setting\n  $a_\\rho$ such that $\\rho_0$ is a surprisingly low practical range and $p_rho$\n  is a small probability (i.e., around .01)\n\n:::\n\n## Computational considerations {transition=\"zoom-in slide-out\" transition-speed=\"slow\"}\n\n- [Super effortful]{.important2}: $vec(\\mathbf{Z}) \\sim \\mathcal{N}(\\mathbf{0},\n  \\sigma^2 \\mathrm{R}_s \\otimes \\mathrm{R}_t)$ [requires $\\mathcal{O}(N^3 T^3)$\n  _flops_ (and storage)]{.important}.\n  \n\n- [Effortful]{.important2}: With linear algebra, we can reduce the computational\n  [complexity (and storage) to $\\approx \\mathcal{O}(N^3 + T^3)$]{.important}\n\n\n- [Neutral]{.important2}: More linear algebra can be used to evaluate a\n  [quadratic form]{.important} with [less operations]{.important}.\n\n\n- [Clever]{.important2}: The [Cholesky decomposition]{.important} of $R^{-1}_t$\n  is [tridiagonal]{.important}.\n\n\n- [Super clever]{.important2}: The complexity to obtain $chol(R^{-1}_s)$ is\n  dramatically decreased using [nearest-neighbor approximations]{.important}\n  [@finley2019efficient].\n\n\n## Bayesian Inference \\& Model Assessment\n\n- [Posterior]{.important2}: $\\pi(\\boldsymbol{\\theta} \\mid \\mathbf{y},\n  \\mathbf{z}) \\propto p(\\mathbf{y} \\mid \\mathbf{z}, \\boldsymbol{\\theta})\n  p(\\mathbf{z} \\mid \\boldsymbol{\\theta}) \\pi(\\boldsymbol{\\theta})$\n\n- [MCMC sampler]{.important2}: No-U-Turn [@hoffman2014no].\n\n- [Convergence assessment]{.important2}: traceplots and split-${\\hat{R}}$\n  [@vehtari2021rank].\n\n- [Goodness-of-fit criteria]{.important2}: LOOIC ([lower values indicate better\n  fit]{.important})\n  \n- [Posterior predictive distributions]{.important2}: $p(\\mathbf{y}^{\\ast} \\mid\n  \\mathbf{y})$\n\n- [Predictions assessment]{.important2}: Interval Score (IS) and RMSP ([lower\n  values indicate better fit]{.important})\n\n\n:::{.notes}\n\n- Point and interval estimates: median and percentiles ($0.025$\n  and $0.975$) of the marginal MCMC samples.\n  \n- Parameters initialized by random sampling from their priors.\n\n- Random effects initialized from a standard normal distribution.\n\n- $a_\\rho$ is chosen so that: $\\mathbb{P}(\\rho > U) = p_\\rho$. In particular,\n  $a_\\rho = - \\log(p_\\rho) / \\rho_0$.\n\n- $\\nu$ hard to be estimated.\n\n\n\nPredictions:\n\n1. use the properties of GP and multivariate Normal distribution to obtain the\n   closed-form distribution of the vector of spatial random effects\n   $\\mathbf{Z}^\\ast$ [@diggle1998model];\n\n2. sample $\\mathbf{z}^\\ast_{(b)}$ from the distribution derived in the previous\n   step;\n\n3. sample $\\mathbf{y}^{\\ast}_{(b)}$ from $p(\\mathbf{y}^{\\ast} \\mid \\boldsymbol{\\theta}_{(b)},\n   \\mathbf{z}^{\\ast}_{(b)})$, where $\\boldsymbol{\\theta}_{(b)}$ is the $b$-th MCMC sample of\n   $\\boldsymbol{\\theta}$.\n\n:::\n\n\n## Spatiotemporal Trend\n\n\n\n::: {.cell layout-align=\"center\" crop='true'}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/sptrend-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n:::{.notes}\n\n- - Another COVARIATE: Presence of prison. Around 24\\% of the municipalities had\n  at least one prison. Incarcerated population was not available at a yearly\n  basis.\n\n- Cases per 100k inhabitants.\n\n- 2015 and 2016: 2014 - World Cup; 2016 Olympic Games.\n\n- 2019 COVID. \n\n- In general, we can see a spatial pattern and a decreasing trend.\n\n:::\n\n\n## Explanatory Variables\n\n\n\n::: {.cell layout-align=\"center\" crop='true'}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/sptcovars-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n:::{.notes}\n\n- pop. dens: log and then scaled.\n\n- idese: scaled (IDESE is released yearly in RS and it is similar to IDH).\n\n- homicide rates: EB then log-transformed then scaled\n\n- HSDR: scaled.\n\n- Transformations: Avoiding long-tails and highly influential observations\n\n:::\n\n## Results: GOF and Predictive Performance\n\n:::{.r-fit-text}\n\n|       | LOOIC                | RMSP               | IS                 |\n|:------|:--------------------:|:------------------:|:------------------:|\n| HGP   | [3516.1]{.important} | [21.1]{.important} | [87.8]{.important} |\n| BYM   | 3606.1               | 123.3              | 176.6              |\n| DAGAR | 3520.9               | 22.4               | 88.8               |\n\n: {.striped}\n\n:::\n\n:::{.notes}\n\n- HGP vs. Specialized Models: When compared to specialized models like DAGAR,\n  the HGP demonstrates highly competitive GOF performance.\n\n- Minor Differences: While DAGAR slightly outperformed on some fit criteria, the\n  overall goodness-of-fit differences between the HGP and DAGAR were minimal.\n\n- Predictive Power: The HGP excels in predictive performance, outperforming\n  competitors on both RMSP (point prediction accuracy) and IS (interval\n  prediction accuracy).\n\n:::\n\n## Results: Relative Risks\n\n:::{.fw}\n\n| Parameter                    | Description   | Estimate          |\n|:-----------------------------|---------------|:-----------------:|\n| $\\exp(\\beta_1)$              | Prison        | 2.34 (1.70, 3.19) |\n| $\\exp(\\beta_2)$              | Pop / km^2^   | 1.33 (1.15, 1.56) |\n| $\\exp(\\beta_2 + \\beta_{21})$ |               | 1.75 (1.18, 2.52) |\n| $\\exp(\\beta_3)$              | HS dropout %  | 1.03 (0.99, 1.07) |\n| $\\exp(\\beta_3 + \\beta_{31})$ |               | 2.25 (1.63, 3.09) |\n| $\\exp(\\beta_4)$              | Homicide rate | 0.97 (0.93, 1.00) |\n| $\\exp(\\beta_4 + \\beta_{41})$ |               | 2.51 (1.83, 3.46) |\n| $\\exp(\\beta_5)$              | IDESE         | 0.99 (0.92, 1.07) |\n\n: {.striped}\n\n:::\n\n:::{.notes}\n\n- relative risk estimates derived from regression coefficients.\n\n- (1): dummy for prison presence; (2) pop/km^2^; (3) homicides; (4) high school;\n  (5) IDESE;\n\n- Double-digit indices represent interactions between variables\n\n- Municipalities with prisons have a 2.34 times higher average TB incidence,\n  even when controlling for other factors.\n\n- homicide rates and hsdr not important in prison-free municipalities but worsen\n  the risk in municipalities with prisons.\n\n:::\n\n\n## Spatiotemporal Dependence\n\n\n\n::: {.cell layout-align=\"center\" crop='true'}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/sptcorr-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n:::{.notes}\n\n- Importance of spatiotemporal term\n\n- Without the municipality random intercept we get even stronger spatial dependence.\n\n- Not possible to make such graph for other areal models.\n\n:::\n\n## Small Municipalities\n\n\n\n::: {.cell layout-align=\"center\" crop='true'}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/sptshrink-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n## Forecast\n\n\n\n::: {.cell layout-align=\"center\" crop='true'}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/sptpred-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n\n# Closing remarks {.section_slide visibility=\"uncounted\"}\n\n## Closing remarks\n\n- **Tailored an HGP extension for spatiotemporal disease mapping.**\n\n- [Competitive]{.important} with specialized models\n\n- It helps to gain insights into spatiotemporal disease mapping through\n  spatiotemporal correlation functions.\n\n- More reliable [estimates of risk factors]{.important}\n\n- [Out-of-sample predictions]{.important} to inform public policies\n\n\n::: {.notes}\n\nKey Takeaway: The HGP's versatility and performance make it a valuable tool in\nyour spatial analysis toolkit.\n\n:::\n\n---\n\n### References {visibility=\"uncounted\"}\n\n<div id=\"refs\"></div>\n\n# Thank you! {.unlisted .section_slide visibility=\"uncounted\"}\n\n![](qr-code-end.png){fig-align=\"center\"}\n\n# Appendix {.appendix}\n\n## Sensitivity analysis\n\n\n\n::: {.cell layout-align=\"center\" crop='true'}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/sens-1.png){fig-align='center' width=960}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}