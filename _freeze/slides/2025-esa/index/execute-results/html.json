{
  "hash": "d7e501deac1955b74b6e16c7e05b2893",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: |\n  `drmr`: A Bayesian approach to Dynamic Range Models in `R`\nsubtitle: |\n  Available at [lcgodoy.me/slides/2025-esa/](https://lcgodoy.me/slides/2025-esa/)\nauthor:\n  - name: Lucas da Cunha Godoy\n    orcid: 0000-0003-4265-972X\n    email: |\n      ldcgodoy@ucsc.com\n    affiliations: EEB Department, UCSC\ndate: 2025-07-28\nbibliography: references.bib\ncsl: styles/asa.csl\nexecute: \n  cache: false\nformat:\n  revealjs:\n    center: true\n    theme: [styles/esa.scss]\n    filters:\n      - styles/appendix.lua\n    embed-resources: true\n    self-contained-math: true\n    toc: true\n    toc-depth: 1\n    smaller: false\n    slide-number: c/t\n    navigation-mode: linear\n    code-overflow: wrap\n---\n\n\n::: {.cell}\n\n:::\n\n\n# Introduction\n\n## The Challenge & Limits of SDMs\n\n* [Critical Challenge]{.important2}: Predicting species' responses to global\n  environmental change is vital for conservation and management.\n\n* [Usual Tool]{.important2}: Species Distribution Models (SDMs) have been the\n  workhorse, [correlating]{.important} occurrences with [environmental\n  variables]{.important}.\n\n* [Limitations of SDMs]{.important2}:\n    * Struggle to predict responses under [novel future]{.important} conditions\n      [@pagel2012forecasting].\n    * [Equilibrium Assumption]{.important2}: Often violated\n      [@guisan2005predicting].\n    * [Lack Mechanism]{.important2}: They [do not explicitly]{.important} model\n      the [underlying biological processes]{.important}.\n\n## Dynamic Range Models (DRMs): A Mechanistic Approach\n\n* [DRMs]{.important} explicitly [incorporate demographic processes]{.important}\n  that drive range dynamics [@pagel2012forecasting].\n\n* Allows linking [environmental]{.important} drivers directly to [specific\n  processes]{.important}.\n\n* Potential for more [robust forecasting]{.important} under [novel]{.important}\n  conditions.\n\n* [Why are they rarely in practice?]{.important2} Despite conceptual appeal,\n  DRMs have been underutilized due to their [complexity]{.important} and\n  [computational]{.important} fitting [challenges]{.important}.\n\n## Introducing `drmr`: Making DRMs Accessible\n\n* [Goal]{.important2}: Bridge the gap between DRM potential and practical\n  application.\n\n* [Key Features]{.important2}:\n    * Develops and applies age-structured DRMs in a Bayesian framework.\n    * User-friendly interface.\n    * Leverages `Stan` via `cmdstanr` for efficient fitting\n      [@gabry2024cmdstanr].\n    * Easily relate environmental drivers to specific recruitment and survival.\n\n# Age-structured DRM\n\n## Setup\n\n* [$Y_{a, t, i}$]{.important2}: [Unobserved density]{.important} of individuals\n  of age $a$, time $t$ and site $i$.\n\n* [$\\lambda_{a, t, i}$]{.important2}: Expected age-specific density.\n\n* [$Y_{t, i} = \\sum_{a} Y_{a, t, i}$]{.important2}: [Observed\n  density]{.important} of individuals of all ages at time $t$ and site $i$.\n\n* [$\\mu_{t, i} = \\sum_{a} \\lambda_{a, t, i}$]{.important2}: Expected \"overall\"\n  density.\n  \n* [$\\rho_{t, i}$]{.important2}: Probability of absence (i.e., $\\mathrm{P}(Y_{t,\n  i} = 0)$).\n\n* [Biological processes]{.important} are encoded through [$\\lambda_{a, t, i}$]{.important}.\n\n* [Key processes]{.important2}: recruitment, survival, and movement\n\n## Modeling assumption and zero-augmented probability density functions (pdf)\n\n$$ f(y_{t, i} \\mid \\mu_{t, i}, \\phi, \\rho_{t, i}) = \\begin{cases} \\rho_{t, i}, &\n  \\text{ if } y_{t, i} = 0, \\\\ (1 - \\rho_{t, i}) g(y_{t, i} \\mid \\mu_{t, i},\n  \\phi), & \\text{ if } y_{t, i} > 0, \\end{cases} $$\n\n* $g(\\cdot \\mid \\mu_{t, i}, \\phi)$ is the [pdf]{.important} of a continuous\n  [probability distribution]{.important}.\n  \n* $\\mu_{t, i}$ is the [expected value]{.important} (theoretical mean) of $Y_{t,\n  i}$ provided the species is present at time $t$ and site $i$.\n\n* $\\phi$ is a nuisance parameter.\n\n## What you are about to see {visibility=\"uncounted\"}\n\n![](img/meme.jpeg){width=75%}\n\n## Modeling assumptions diagram\n\n```{mermaid}\nflowchart TD\n    A[\"$$\\lambda_{1, t, i} = \\exp \\{ \\mathbf{\\beta}^{\\top}_r \\mathbf{x}^{(r)}_{t, i} + z^{(r)}_{t, i} \\} $$\"]\n    B[\"$$\\lambda_{a, t, i} = \\lambda_{a - 1, t - 1, i} \\cdot s_{a - 1, t - 1, i} $$\"]\n    C((\"$$\\mu_{t, i}$$\"))\n    D(\"$$\\mathrm{logit}(\\rho_{t, i}) = \\boldsymbol{\\beta}^{\\top}_{t} \\mathbf{x}^{(t)}_{t, i} $$\")\n    E[\"$$\\log(s_{a, t, i}) = \\boldsymbol{\\beta}^{\\top}_s \\mathbf{x}^{(s)}_{t, i} + z^{(s)}_{t, i} - f_{a, t}$$\"]\n    F{\"$$Y_{t, i}$$\"}\n    G((\"$$\\phi$$\"))\n    A --->B\n    E --->B\n    B-- $$\\sum_a$$ -->C\n    C-.->F\n    D-.->F\n    G-.->F\n```\n\n## Diagram v2\n\n```{mermaid}\ngraph TD\n    subgraph \"Demographic processes\"\n        %% Inputs and Parameters for lambda1\n        xr[\"$$\\mathbf{x}^{(r)}_{t, i}$$\"] --> lambda1((\"$$\\lambda_{1, t, i}$$\"));\n        zr((\"$$z^{(r)}_{t, i}$$\")) --> lambda1;\n        betar((\"$$\\boldsymbol{\\beta}_r$$\")) --> lambda1;\n\n        %% Recursive part for lambda_a\n        subgraph \"Time t-1\"\n            xs[\"$$\\mathbf{x}^{(s)}_{t - 1, i}$$\"] --> s_prev;\n            zs((\"$$z^{(s)}_{t - 1, i}$$\")) --> s_prev;\n            betas((\"$$\\boldsymbol{\\beta}_s$$\")) --> s_prev;\n            f[\"$$f_{a - 1, t - 1}$$\"] --> s_prev;\n            lambda_prev(\"$$\\lambda_{a - 1, t - 1, i}$$\")\n            s_prev(\"$$s_{a - 1, t - 1, i}$$\")\n        end\n        \n        lambda_prev --> lambda_a((\"$$\\lambda_{a, t, i}$$\"));\n        s_prev --> lambda_a;\n    end\n\n    %% Mean calculation\n    lambda_a --> mu((\"$$\\mu_{t, i}$$\"));\n\n    subgraph \"Zero-augmentation\"\n        xt[\"$$\\mathbf{x}^{(t)}_{t, i}$$\"] --> rho((\"$$\\rho_{t, i}$$\"));\n        betat((\"$$\\boldsymbol{\\beta}_t$$\")) --> rho;\n    end\n\n    %% Final Observation\n    mu --> Y{\"$$Y_{t, i}$$\"};\n\n    %% Other components\n    phi((\"$$\\phi$$\")) --> Y;\n    rho --> Y;\n```\n\n## Code & workflow\n\n![](img/fitting.png)\n\n<!-- ## Toggles and model complexity -->\n\n<!-- | Toggle     | Description                                                                                                                | Default State                   | -->\n<!-- |------------|----------------------------------------------------------------------------------------------------------------------------|---------------------------------| -->\n<!-- | `rho_mu`   | Use the complementary log-log (cloglog) link function for absence probability. If off, the logistic link function is used. | On                              | -->\n<!-- | `cloglog`  | Use the complementary log-log (cloglog) link function for absence probability. If off, the logistic link function is used. | Off                             | -->\n<!-- | `movement` | Enable the movement routine as described.                                                                                  | Off                             | -->\n<!-- | `est_surv` | Estimate survival probabilities within the model.                                                                          | On                              | -->\n<!-- | `est_init` | Estimate $\\lambda$ initial values.                                                                                         | Off (this one has many options) | -->\n<!-- | `minit`    | Initial values driven by mortality rates.                                                                                  | Off                             | -->\n<!-- | `iid_re`   | Include an IID random effect.                                                                                              | `\"none\"`                        | -->\n<!-- | `ar_re`    | Include an AR(1) random effect.                                                                                            | `\"none\"`                        | -->\n<!-- | `sp_re`    | Include an iCAR random effect.                                                                                             | `\"none\"`                        | -->\n\n\n# Illustration with real data\n\n## Summer Flounder Dataset\n\n* An example analysis uses [Summer flounder]{.important} (_Paralichthys\n  dentatus_) data from 1982-2016 NOAA [bottom trawl surveys]{.important}\n  [@fredston2025dynamic] to illustrate the [package's features]{.important}.\n\n* The data spans the US Atlantic coast (Cape Hatteras, NC\n  to the Canada/Maine border) and was [aggregated from individual hauls into 10\n  latitudinal patches]{.important} with varying areas.\n\n* [Response variable]{.important2}: Density (count per unit area).\n\n* [Environmental drivers]{.important2}: SST and SBT.\n\n## Patches/sites\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"leaflet html-widget html-fill-item\" id=\"htmlwidget-c9e9439d9cb974828f32\" style=\"width:960px;height:480px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-c9e9439d9cb974828f32\">{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"calls\":[{\"method\":\"addPolygons\",\"args\":[[[[{\"lng\":[-75.25125253796918,-75.29151946221847,-75.34999999999999,-75.5,-75.433333,-74.80638,-74.8,-74.79900000000001,-74.84999999999999,-75.25125253796918],\"lat\":[35.18558043175311,35.18407190072807,35.25,35.96666699999999,35.983333,35.997423,35.983333,35.589167,35.53333300000001,35.18558043175311]}]],[[{\"lng\":[-75.77033299999999,-75.77033299999999,-75.733333,-75.65000000000001,-75.229528,-74.62637700000001,-74.63333299999999,-74.783333,-74.8,-74.88333299999999,-74.90000000000001,-75.033333,-75.59245300000001,-75.7,-75.716667,-75.766667,-75.77033299999999,-75.77033299999999],\"lat\":[36.871833,36.87183300000001,36.933333,36.983333,36.992352,36.99304,36.916667,36,36.00000000000001,36,36,36,36.008918,36.21666700000002,36.266667,36.783333,36.87183299999999,36.871833]}]],[[{\"lng\":[-75.693563,-75.609667,-75.38333299999999,-75.09999999999999,-75.024123,-74.833333,-74.17666699999999,-74.066667,-74.051182,-74.00879500000001,-74.63645,-74.783333,-75.13333299999999,-75.266667,-75.66367,-75.683333,-75.693563],\"lat\":[37.068282,37.26949999999999,37.633333,37.933333,37.978618,37.983333,37.986667,37.983333,37.974693,37.916173,37.011418,37,37.00000000000001,37.00000000000001,37.00344499999999,37.016667,37.068282]}]],[[{\"lng\":[-74.937905,-74.733333,-74.55,-74.50942999999999,-74.16801700000002,-72.818833,-72.835488,-72.916667,-73.05,-73.233333,-73.928667,-74.05,-74.3,-74.967022,-75.016667,-74.937905],\"lat\":[38.709393,38.933333,38.983333,38.989367,38.996557,38.995167,38.94526,38.833333,38.683333,38.53333300000001,38.010333,38,38.00000000000001,38.015152,38.15,38.709393]}]],[[{\"lng\":[-74.41461177838244,-74.3933813,-74.35924229999999,-74.330922,-74.31786049999999,-74.31334389999999,-74.30492099999999,-74.3021134,-74.3516333,-74.36555546759509,-74.32232434417743,-74.3212784,-74.318186,-74.3162736,-74.3109025,-74.29735269999999,-74.2901912,-74.3035376,-74.31086817481327,-74.26984441388035,-74.2564184,-74.24754799999999,-74.2521149,-74.2436225,-74.2109088,-74.1987623,-74.1817794,-74.16755120000001,-74.16601369999999,-74.1611398,-74.1633195,-74.1807347807319,-74.0867991945404,-74.1004384,-74.09301259999999,-74.07233959999999,-74.0674241,-74.06627426979168,-74.016667,-73.927122,-69.22099799999999,-69.216667,-69.31666700000001,-72.716667,-72.783333,-72.83,-72.916667,-72.95,-73.11666700000001,-73.433333,-74.316667,-74.53333300000001,-74.584818,-74.613,-74.44475100767968,-74.4444067,-74.41344149999999,-74.42178299999999,-74.42380186665528,-74.41461177838244],\"lat\":[39.39218403470763,39.38914620000001,39.4015567,39.4260928,39.4540063,39.45514560000001,39.4597842,39.4647484,39.47020089999999,39.46567905557492,39.53030144698049,39.52973050000001,39.5246443,39.5145531,39.5066592,39.5086124,39.5231387,39.5416527,39.54740345020237,39.60856625625097,39.6116397,39.6214053,39.6313548,39.6434859,39.6509653,39.67613950000001,39.6919885,39.6993676,39.70409810000001,39.72086880000001,39.7351749,39.74099986651173,39.87998330738449,39.78323279999999,39.7763371,39.87537930000001,39.9033052,39.91026636623728,39.983333,39.99859,39.991333,39.983333,39.95,39.03333300000001,39.016667,39.006833,39.00000000000001,39,39,39.00000000000001,38.99999999999998,39,39.02381499999999,39.093167,39.34694298060439,39.3471133,39.3571231,39.3752302,39.37839611641341,39.39218403470763]},{\"lng\":[-74.1328833,-74.1599866,-74.24007209999999,-74.2546397,-74.25446529999999,-74.2557674,-74.2564184,-74.2316324,-74.18430839999999,-74.1479015,-74.12968160000001,-74.10578370000002,-74.09813389999999,-74.1094865,-74.1182755,-74.1328833],\"lat\":[39.7146671,39.6854635,39.5753879,39.5473619,39.5346133,39.5297305,39.5222029,39.55299120000001,39.6155547,39.66589560000001,39.70128969999999,39.72915269999999,39.7556827,39.7489281,39.7379825,39.7146671]}],[{\"lng\":[-74.35879469999999,-74.37173419999999,-74.3866268,-74.39976969999999,-74.40774160809889,-74.36688488746819,-74.35879469999999],\"lat\":[39.44717030000001,39.4365909,39.40648020000001,39.3993594,39.40248734244979,39.46368966446297,39.44717030000001]}]],[[{\"lng\":[-72.88160939136345,-72.87907469999999,-72.8527921,-72.83275309999999,-72.82178392335796,-72.68933083515633,-72.67932499999999,-72.66358,-72.6505164,-72.67845849999999,-72.7253868,-72.73169439999999,-72.73790439999999,-72.73200439999999,-72.72395469999999,-72.70444209999999,-72.6052799,-72.5418188,-72.5023087,-72.4907934,-72.49112718407322,-72.45461832268153,-72.46076409999999,-72.4412736,-72.4066579,-72.37173419999999,-72.32512162015966,-71.966667,-71.91954699999999,-71.883163,-66.542717,-66.466667,-66.478933,-66.8,-67.078667,-67.267132,-67.533333,-68.3,-68.895303,-69.140252,-69.32942300000001,-69.75,-69.833333,-70.533333,-70.933333,-70.966667,-71.09999999999999,-71.2,-72.63333299999999,-73.76666700000001,-74,-74.03149999999999,-73.88333299999999,-73.84720299999999,-73.741793,-73.41160917825194,-73.3895158,-73.3203242,-73.2561444,-73.24840159999999,-73.2694568,-73.26964435680146,-72.88160939136345],\"lat\":[40.75065365616359,40.7456858,40.74942310000001,40.7596296,40.76613921375962,40.80028862471535,40.80094,40.8007731,40.7974552,40.7909998,40.778379,40.7776489,40.7737898,40.7699649,40.7704193,40.776177,40.8013303,40.820502,40.8390567,40.84686920000001,40.85104195199939,40.8603452106629,40.8526065,40.8550072,40.8620721,40.87584059999999,40.8932299914521,40.983333,40.992955,40.996497,40.981272,40.966667,40.937338,40.683333,40.532,40.447095,40.36666700000001,40.183333,40.049822,40.021852,40.00230800000001,40,39.99999999999999,40,40,40,40,40,39.99999999999999,40,40.033333,40.04816699999999,40.45,40.48523999999999,40.52377,40.61179741673742,40.6167667,40.6350559,40.63905189999999,40.6477203,40.6492958,40.64928572796674,40.75065365616359]},{\"lng\":[-72.8815111,-72.9142686,-72.9489038,-73.0139054,-73.04034299999999,-73.10465859999999,-73.17661,-73.21883029999999,-73.2552915,-73.3050461,-73.2974586,-73.245783,-73.1475317,-73.041005,-72.99152579999999,-72.9134765,-72.8315324,-72.80492099999999,-72.75723929999999,-72.7570827,-72.77923009999999,-72.83237009999999,-72.8815111],\"lat\":[40.7343999,40.7245272,40.7153857,40.6904564,40.6819952,40.6672203,40.6509979,40.6396346,40.6296684,40.6299218,40.62262239999999,40.6238061,40.64431390000001,40.67263419999999,40.68817780000001,40.71290119999999,40.7416446,40.7508406,40.7600857,40.76880209999999,40.76684319999999,40.7477443,40.7343999]}]],[[{\"lng\":[-70.07116704067167,-70.0686743,-70.0573624,-70.05298400723476,-70.03087132842268,-70.0281469,-70.01866609999999,-70.0060115,-69.9866837,-69.9866837,-70.0031632,-70.0115861,-70.0214738,-70.0018204,-70.0038454,-70.0001115,-70.0214738,-70.0364477,-70.0702414,-70.1008195,-70.1913143,-70.2437231,-70.27472899999999,-70.3152563,-70.33519450000001,-70.33950759999999,-70.3264868,-70.28986569999999,-70.27472899999999,-70.4008683,-70.42992776987415,-70.07116704067167],\"lat\":[41.92036802384033,41.8932966,41.9042423,41.92877688073772,41.93899617572848,41.93797440000001,41.9300805,41.92283760000001,41.92121,41.9137637,41.9085961,41.9068871,41.90692780000001,41.8819034,41.84629630000001,41.8163109,41.7909203,41.7858341,41.7734584,41.7659366,41.7470564,41.7241072,41.7151553,41.7155622,41.7192244,41.7257348,41.7313907,41.73163479999999,41.7362735,41.7450219,41.75341425144679,41.92036802384033]}],[{\"lng\":[-71.5594737,-71.55911870098743,-71.38333299999999,-70.65204088974194,-70.65249589999999,-70.66173259999999,-70.6856176,-70.6586817,-70.5960587,-70.565826,-70.5327042,-70.50426179999999,-70.4798478,-70.4590958,-70.4283748,-70.41808019999999,-70.4058732,-70.3915909,-70.3808488,-70.3658748,-70.35195879999999,-70.3190812,-70.30304930000001,-70.27599040000001,-70.2610571,-70.2712296,-70.27277579999999,-70.2641495,-70.2485245,-70.2398982,-70.2296443,-70.2173559,-70.18529210000001,-70.13687089999999,-69.9781388,-69.93887289999999,-69.9325252,-69.93423419999999,-69.94200599999999,-69.95665439999999,-69.9798478,-69.9757381,-69.9720353,-69.9639612,-69.95335849999999,-69.93887289999999,-69.93468179999999,-69.93101969999999,-69.9277238,-69.924672,-69.94325529999999,-69.982168,-69.986334934353,-69.915593,-65.756373,-65.7,-65.7,-65.75,-65.95,-66.016667,-66.423412,-66.433333,-67.11666700000001,-67.283333,-67.45,-67.8,-68.25,-68.333333,-69.016667,-69.083333,-69.2,-69.25,-70.3,-70.533333,-70.84999999999999,-70.983333,-71.816667,-71.84999999999999,-71.86666700000001,-71.916667,-71.873255,-71.61078315425549,-71.61271719999999,-71.6137476,-71.59955029999999,-71.57157169999999,-71.5490946,-71.54447329999999,-71.55186929999999,-71.5599259,-71.5661515,-71.5594737],\"lat\":[41.20102400000001,41.20183484899079,41.3,41.64905224261773,41.57802969999998,41.5504825,41.53082920000001,41.5213491,41.55304599999999,41.5581729,41.5591495,41.5637068,41.57387930000002,41.5916202,41.63190340000001,41.6400414,41.6375186,41.6192081,41.6229923,41.6327986,41.6351993,41.6326358,41.6347517,41.6442325,41.6462263,41.6210391,41.6105818,41.61615630000001,41.6356876,41.6432559,41.6462263,41.6482608,41.66054920000001,41.6605492,41.6818301,41.6742211,41.74103420000001,41.7929548,41.8064639,41.80780670000001,41.7970645,41.8105329,41.8391788,41.84353290000001,41.8408878,41.8318546,41.8320987,41.8329532,41.83486559999999,41.8380801,41.8576253,41.9536212,41.95955570160746,41.99215,41.982562,41.9,41.833333,41.74999999999999,41.466667,41.383333,41.009112,41,41,41,41,41,41,41,41,41,41,41.00000000000001,41,41.00000000000002,41,41,41,41,41,41,41.025005,41.17287649204038,41.16746700000001,41.1551809,41.145779,41.1497693,41.1520421,41.1628876,41.17572659999999,41.1837426,41.19375230000001,41.20102400000001]},{\"lng\":[-70.0541494,-70.0372208,-70.0443009,-70.0760799,-70.0602921,-70.03233800000001,-70.0140275,-70.02009029999999,-70.03140209999999,-70.0460099,-70.0714005,-70.0819393,-70.0897111,-70.09776769999999,-70.1068009,-70.1242882,-70.16105109999999,-70.2172879,-70.2408161,-70.2562878,-70.27235809999999,-70.2781124,-70.2563486,-70.2331437,-70.1377452,-70.09759609999999,-70.04303849999999,-70.0011299,-69.96714919999999,-69.95775979999999,-69.974965,-70.0052791,-70.0192021,-70.02887009999999,-70.03974579999999,-70.05239619999999,-70.0541494],\"lat\":[41.392686,41.3728702,41.3509789,41.3111026,41.3166365,41.33950430000001,41.3446313,41.3307966,41.31753159999999,41.3075626,41.3015811,41.2925479,41.2899844,41.290432,41.29523349999999,41.2958709,41.29296679999999,41.29742710000001,41.30093190000001,41.30916010000001,41.3113476,41.3079066,41.2927671,41.2837589,41.24715239999999,41.2418296,41.2433339,41.2392566,41.2494529,41.27574790000001,41.3021915,41.3427188,41.3701168,41.38611969999999,41.3943593,41.3965625,41.392686]},{\"lng\":[-70.5005997,-70.4947811,-70.4812719,-70.46548419999999,-70.45287019999999,-70.44668539999999,-70.4449357,-70.44603429999999,-70.4557186,-70.4706925,-70.4869279,-70.5005997],\"lat\":[41.39362209999999,41.3823103,41.36957429999999,41.3602563,41.3588728,41.36741769999999,41.3820255,41.41351959999999,41.42963290000001,41.4203148,41.40265530000001,41.39362209999999]},{\"lng\":[-70.5764054,-70.5565486,-70.546254,-70.5457658,-70.55589759999999,-70.570424,-70.57949789999999,-70.5887752,-70.6036678,-70.593007,-70.6051326,-70.6599015,-70.6896053,-70.7026261,-70.71532139999999,-70.74217689999999,-70.75450599999999,-70.78197179999999,-70.8462215,-70.8462215,-70.8340551,-70.8149715,-70.80467689999999,-70.786407,-70.77590900000001,-70.74767009999999,-70.7239477,-70.6962784,-70.666005,-70.5250138,-70.5074357,-70.51740479999999,-70.5493058,-70.56334389999999,-70.5764054],\"lat\":[41.4278018,41.43650950000001,41.4442813,41.45392489999998,41.4687361,41.47394440000001,41.4658878,41.454169,41.4482283,41.4716658,41.4740258,41.45652899999998,41.4330915,41.4278018,41.4203555,41.3848331,41.372504,41.35423410000001,41.3540714,41.3466658,41.3399112,41.3207055,41.3125675,41.3041446,41.3043887,41.3310001,41.34271880000001,41.3515079,41.35700099999999,41.35907620000001,41.3626163,41.41351959999999,41.4145369,41.41868720000001,41.4278018]},{\"lng\":[-69.97301179999999,-69.98102779999999,-70.0214738,-70.0021053,-69.9762264,-69.9593807,-69.9599503,-69.96129309999999,-69.96507729999999,-69.97301179999999],\"lat\":[41.6537133,41.6276716,41.5507266,41.5537784,41.6122908,41.6326358,41.6406925,41.6469587,41.6513533,41.6537133]},{\"lng\":[-70.830471,-70.8322824,-70.82310819999999,-70.8109025,-70.80175630000001,-70.80179749999999,-70.8091264,-70.81402059999999,-70.82193459999999,-70.830471],\"lat\":[41.26036559999999,41.2566918,41.25076,41.24804579999999,41.2480762,41.25678449999999,41.2595143,41.26316740000001,41.2603927,41.26036559999999]},{\"lng\":[-70.87117619999999,-70.8976462,-70.9113351,-70.9260299,-70.94067749999999,-70.94850339999999,-70.9386655,-70.9279167,-70.9063858,-70.8926539,-70.8759838,-70.8544536,-70.84859849999999,-70.85649359999999,-70.8594645,-70.87117619999999],\"lat\":[41.4386695,41.4363718,41.42970589999999,41.4289169,41.4207749,41.41412360000001,41.4112201,41.4186197,41.4223711,41.4224221,41.4224805,41.42916760000001,41.4343321,41.4431278,41.4482651,41.4386695]},{\"lng\":[-70.7243544,-70.7429667,-70.78212379999999,-70.8026527,-70.81340279999999,-70.8281252,-70.83986060000001,-70.8329507,-70.80845739999999,-70.7908163,-70.76830590000002,-70.757554,-70.75856519999999,-70.7428932,-70.7183984,-70.69978429999999,-70.679194,-70.6949255,-70.71063819999999,-70.7243544],\"lat\":[41.5110997,41.5007659,41.4786234,41.4631331,41.45501780000001,41.45718180000002,41.4505308,41.4424654,41.4469462,41.44919889999999,41.4595462,41.4683926,41.47574059999999,41.48165440000001,41.4919982,41.5023268,41.5104496,41.5170372,41.519214,41.5110997]}]],[[{\"lng\":[-70.08321199449233,-70.1178635,-70.1464663,-70.1676617,-70.1922199,-70.2157641,-70.22757959674141,-70.31216999999999,-70.416667,-70.583333,-70.63333299999999,-70.63333299999999,-70.63174390000002,-70.6234432,-70.61843829999999,-70.6114803,-70.5970353,-70.5970353,-70.60220289999999,-70.5993953,-70.59805249999999,-70.6078589,-70.62124589999999,-70.62991289999999,-70.63333299999999,-70.63333299999999,-70.63174390000002,-70.63333299999999,-70.63333299999999,-70.62599299999999,-70.59999999999999,-70.45441,-70.19532,-70.07902799999999,-67.492833,-66.82223999999999,-66.7595,-65.84999999999999,-65.757735,-65.68000000000001,-65.675833,-65.7,-65.75,-65.916667,-66.233333,-66.583333,-66.766667,-66.816667,-67.033333,-67.05,-67.316667,-67.73333300000002,-67.78333300000001,-67.8,-68,-68.033333,-68.13333299999999,-68.833333,-69.233333,-69.7,-70.08321199449233],\"lat\":[42.05920302231893,42.0738054,42.0810109,42.0829769,42.08606200000001,42.08464249999999,42.08114780293653,42.09391500000001,42.116667,42.31666700000001,42.416667,42.61184156403397,42.61273829999999,42.6204695,42.62885160000001,42.6345076,42.6344669,42.6406111,42.6486677,42.65770089999999,42.6649844,42.6679548,42.6686872,42.6720645,42.67935090148019,42.68250353335877,42.6946068,42.69400611106508,42.816667,42.87399,42.89999999999999,42.961495,42.981307,42.985607,42.995,42.984893,42.967833,42.383333,42.273052,42.15166700000001,42.065167,42,42,42.00000000000001,41.99999999999999,42,42,42.00000000000001,42,42.00000000000001,42,41.99999999999999,41.99999999999999,42,42.00000000000001,41.99999999999999,42,42,41.99999999999999,42.00000000000001,42.05920302231893]}]],[[{\"lng\":[-70.38333299999999,-70.45,-70.166667,-70.03533299999999,-69.88333299999999,-69.37266700000001,-68.800282,-68.61666700000001,-68.433333,-68.287167,-67.402568,-66.783333,-66.77883300000001,-66.524,-66.52376700000001,-66.56375800000001,-66.833333,-68.09999999999999,-68.166667,-68.566667,-68.63333299999999,-70.316667,-70.38333299999999],\"lat\":[43.016667,43.066667,43.433333,43.52916699999999,43.6,43.791667,43.927917,43.966667,43.983333,43.990667,43.992615,43.983333,43.98000000000001,43.65433300000001,43.545767,43.07606800000001,43,43,43,43,43,43,43.016667]}]],[[{\"lng\":[-67.57325434628387,-67.41611748801427,-66.721667,-66.766667,-67.06666700000001,-67.15000000000001,-68.40000000000001,-67.966667,-67.716667,-67.57325434628387],\"lat\":[44.40130279969741,44.39687204473454,44.01516699999998,44,43.99999999999999,44,44,44.233333,44.35,44.40130279969741]}]]],null,null,{\"interactive\":true,\"className\":\"\",\"stroke\":true,\"color\":\"#000000\",\"weight\":5,\"opacity\":0.5,\"fill\":true,\"fillColor\":\"#000000\",\"fillOpacity\":0.2,\"smoothFactor\":1,\"noClip\":false},null,null,null,{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]},{\"method\":\"addTiles\",\"args\":[\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",null,null,{\"minZoom\":0,\"maxZoom\":18,\"tileSize\":256,\"subdomains\":\"abc\",\"errorTileUrl\":\"\",\"tms\":false,\"noWrap\":false,\"zoomOffset\":0,\"zoomReverse\":false,\"opacity\":1,\"zIndex\":1,\"detectRetina\":false,\"attribution\":\"&copy; <a href=\\\"https://openstreetmap.org/copyright/\\\">OpenStreetMap<\\/a>,  <a href=\\\"https://opendatacommons.org/licenses/odbl/\\\">ODbL<\\/a>\"}]}],\"limits\":{\"lat\":[35.18407190072807,44.40130279969741],\"lng\":[-75.77033299999999,-65.675833]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n## Models fitted to the data\n\n| Model      | Description                                                                                                                                                                                       |\n|------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| DRM (rec)  | Recruitment as a quadratic function of SST, AR(1) random effect for recruitment, Fishing mortality, Movement, Absence probability as a function of effort (number of hauls) and estimated density |\n| DRM (surv) | Surival as a quadratic function of SBT, AR(1) random effect for recruitment, Fishing mortality, Movement, Absence probability as a function of effort (number of hauls) and estimated density     |\n| GLM-SDM    | A zero-augmented LogNormal SDM with the absence probability as a function of the number of hauls (a measure of effort).                                                                           |\n\n## Code for DRM (rec)\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndrm_rec <-\n  fit_drm(.data = dat_train,\n          y_col = \"dens\", ## response variable: density\n          time_col = \"year\", ## vector of time points\n          site_col = \"patch\",\n          family = \"gamma\", ## other options: lognormal, loglogistic\n          seed = 202505,\n          formula_zero = ~ 1 + c_hauls,\n          formula_rec = ~ 1 + c_sst + I(c_sst * c_sst),\n          formula_surv = ~ 1,\n          f_mort = f_train,\n          n_ages = NROW(f_train),\n          adj_mat = adj_mat, ## A matrix for movement routine\n          ages_movement = c(0, 0,\n                            rep(1, 12),\n                            0, 0), ## ages allowed to move\n          .toggles = list(ar_re = \"rec\",\n                          movement = 1,\n                          est_surv = 1,\n                          est_init = 0,\n                          minit = 1),\n          .priors = list(pr_phi_a = 1, pr_phi_b = .1,\n                         pr_alpha_a = 4.2, pr_alpha_b = 5.8,\n                         pr_zeta_a = 7, pr_zeta_b = 3))\n```\n:::\n\n\n## Code for DRM (rec)\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndrm_surv <-\n  fit_drm(.data = dat_train,\n          y_col = \"dens\", ## response variable: density\n          time_col = \"year\", ## vector of time points\n          site_col = \"patch\",\n          family = \"gamma\", ## other options: lognormal, loglogistic\n          seed = 202505,\n          formula_zero = ~ 1 + c_hauls,\n          formula_rec = ~ 1,\n          formula_surv = ~ 1 + c_sbt + I(c_sst * c_sbt),\n          f_mort = f_train,\n          n_ages = NROW(f_train),\n          adj_mat = adj_mat, ## A matrix for movement routine\n          ages_movement = c(0, 0,\n                            rep(1, 12),\n                            0, 0), ## ages allowed to move\n          .toggles = list(ar_re = \"rec\", ## other options: \"surv\", \"dens\"\n                          movement = 1,\n                          est_surv = 1,\n                          est_init = 0,\n                          minit = 1),\n          .priors = list(pr_phi_a = 1, pr_phi_b = .1,\n                         pr_alpha_a = 4.2, pr_alpha_b = 5.8,\n                         pr_zeta_a = 7, pr_zeta_b = 3))\n```\n:::\n\n\n\n## Effect of environmental variables on specific processes\n\n* Recruitment and SST:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnewdata_rec <- data.frame(c_sst =\n                            seq(from = quantile(dat_train$c_sst, .05),\n                                to = quantile(dat_train$c_sst, .95),\n                                length.out = 200))\n\nrec_samples <- marg_rec(drm_rec, newdata_rec)\n```\n:::\n\n\n* Survival and SBT:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnewdata_surv <- data.frame(c_sbt =\n                             seq(from = quantile(dat_train$c_sbt, .05),\n                                 to = quantile(dat_train$c_sbt, .95),\n                                 length.out = 200))\n\nsurv_samples <- marg_surv(drm_surv, newdata_surv)\n```\n:::\n\n\n## Effect of environmental variables\n\n\n::: {.cell layout-ncol=\"2\"}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/plot-1.png){width=960}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/plot-2.png){width=960}\n:::\n:::\n\n\n## Forecasting\n\n* The code for obtaining out-of-sample predictions is quite intuitive.\n\n* We only need to provide the output for a model fit, a new dataset (where we\n  want the predictions), and a seed:\n  \n\n::: {.cell}\n\n```{.r .cell-code}\nforecast_rec <- predict_drm(drm = drm_rec,\n                            new_data = dat_test,\n                            past_data = filter(dat_train,\n                                               year == max(year)),\n                            seed = 125,\n                            cores = 4)\n```\n:::\n\n\n\n## Forecasts visualization\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/forecast-1.png){width=960}\n:::\n:::\n\n\n\n## Comparing models\n\n| Model      | RMSE |   IS |  PIC |\n|:-----------|-----:|-----:|-----:|\n| DRM (rec)  | 0.08 | 0.74 | 90.0 |\n| DRM (surv) | 0.10 | 1.01 | 96.0 |\n| GLM-SDM    | 0.14 | 1.18 | 74.0 |\n\n\n# Concluding remarks\n\n## Highlights\n\n* The `drmr` substantially lowers the barrier for ecologists to use the DRM in\n  their applications.\n\n* The code is easy to use and takes advantage of what has been developed for\n  `Stan`: visualization, diagnostic tools, and estimation.\n\n* `drmr` allows for empirically testing which processes are more important to\n  predict the distribution of a species.\n  \n* The more complex a model is, the more (and better) data we need to be able to\n  estimate those relationships.\n\n\n## Future work\n\n* Include population dynamic models that explicitly relate adult density to\n  recruitment (e.g., Ricker, Belverton-Holt)\n\n* GAM-like non-parametric relationships between processes and the environment\n\n* Support for length-composition data\n\n* More realistic movement routines\n\n## Acknowledgements\n\n* Malin, Alexa, Jude, Jeewantha, Mark, and many others.\n\n---\n\n### References {visibility=\"uncounted\"}\n\n<div id=\"refs\"></div>\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<script src=\"../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"../../site_libs/leaflet-1.3.1/leaflet.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/leaflet-1.3.1/leaflet.js\"></script>\n<link href=\"../../site_libs/leafletfix-1.0.0/leafletfix.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/proj4-2.6.2/proj4.min.js\"></script>\n<script src=\"../../site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js\"></script>\n<link href=\"../../site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/leaflet-binding-2.2.2/leaflet.js\"></script>\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}