{
  "hash": "a196e0190f10a5edeae1a241aa22d6ba",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: |\n  HAUSDORFF--GAUSSIAN PROCESS WITH SPATIAL AND SPATIOTEMPORAL APPLICATIONS\nauthor:\n  - name: Lucas da Cunha Godoy\n    orcid: 0000-0003-4265-972X\n    affiliations: Department of Statistics, UConn\ndate: 2024-04-10\nbibliography: references.bib\ncsl: asa.csl\nformat:\n  revealjs:\n    theme: [my-theme.scss]\n    output-file: defense.html\n    embed-resources: true\n    self-contained-math: true\n    toc: true\n    toc-depth: 1\n    smaller: false\n    slide-number: c/t\n    navigation-mode: linear\n    html-math-method:\n      method: mathjax\n      url: \"https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML\"\n---\n\n\n\n# Introduction {.section_slide visibility=\"uncounted\"}\n\n\"Everything is related to everything else, but near things are more\nrelated than distant things.\"\n---Tobler's first law of geography\n\n##  Spatial Data\n\n\\newcommand\\indicator{1\\kern-0.25em\\text{l}}\n\\newcommand\\REALS{1\\kern-0.2em\\text{R}}\n\\newcommand\\E{\\mathbb{E}}\n\\newcommand\\dd{\\mathrm{d}}\n\n\n::: {.cell}\n\n:::\n\n\n- Taking into account [spatial dependence]{.important} possibly present in data\n  is a foremost aspect of spatial statistics.\n\n- Statistical [inference depends]{.important} heavily on the spatial\n  [structure/geometry]{.important} of the observed spatial data.\n\n| Geometry             | Branch               |\n|:--------------------:|:--------------------:|\n| Point-referrenced    | Geostatistics        |\n|                      | Point patterns       |\n| Areal units/polygons | Lattice/Areal models |\n| Mixed                | Spatial Data Fusion  |\n\n: {.striped}\n\n## Areal Data {transition=\"fade-in-then-out\"}\n\n\n::: {.cell crop='true'}\n::: {.cell-output-display}\n![Example of areal data.](index_files/figure-revealjs/fig-areal-1.png){#fig-areal width=960}\n:::\n:::\n\n\n## Point-refereced Data  {transition=\"fade-in-then-out\"}\n\n\n::: {.cell crop='true'}\n::: {.cell-output-display}\n![Example of point-referrenced data.](index_files/figure-revealjs/fig-point-1.png){#fig-point width=960}\n:::\n:::\n\n\n## Fused Data\n\n\n::: {.cell crop='true'}\n::: {.cell-output-display}\n![Example of fused data.](index_files/figure-revealjs/fig-fused-1.png){#fig-fused width=960}\n:::\n:::\n\n\n## General Spatial Model\n\nThe model below is flexible enough to analyze most spatial data structures\n[@cressie1993statistics]\n\n$$\\{ Z(\\mathbf{s}) \\; : \\; \\mathbf{s} \\in D \\},$$ \n\nwhere [$D$ is an index set]{.important}.\n\n- [Areal models]{.important2}: index set is [countable]{.important}.\n  \n- [Geostatistics]{.important2}: index set is a [continuum]{.important}.\n\n:::{.notes}\n\n- Challenges arise when working with data from different sources:\n  \n  - Change of support\n  \n  - Spatial misalignment\n  \n  - Data fusion itself.\n\n:::\n\n## Gaussian Process\n\n- [Gaussian Process (GP)]{.important2}: a stochastic process such that all its\n  [finite-dimensional marginal]{.important} distributions are multivariate\n  [normal]{.important} distributions.\n  \n- [GP components]{.important2}: A [mean]{.important} and a [covariance\n  functions]{.important} defined as, respectively, $\\E[Z(\\mathbf{s})] =\n  m(\\mathbf{s})$ and ${\\rm Cov}(Z(\\mathbf{s}_1), Z(\\mathbf{s}_2)) = C(\\mathbf{s}_1,\n  \\mathbf{s}_2)$.\n  \n- Common assumptions are [stationarity]{.important} and\n  [isotropy]{.important}.\n\n- [Importance in spatial statistics]{.important2}: predominant foundation of\n  geostatistical modeling.\n  \n:::{.notes}\n\nLoosely speaking, this means the GP has stationary mean, variance, and a\ncorrelation function such that the correlation between two data points depends\nsolely on their distance.\n\nThe main reasons these models are not applied to areal data are:\n\n1. Calculating distance between areal spatial units is non-trivial;\n    \n1. The commonly used areal models are computationally efficient.\n\n:::\n\n\n## Areal Data and the CAR Model\n\n- $Z_k \\mid Z_{-k} \\sim \\mathcal{N}\\left (\\frac{\\psi} {m_k} \\sum_{i \\sim k} Z_i,\n\\frac{\\tau^2}{m_k} \\right)$\n\n- Special case: [ICAR]{.important}.\n\n- Extensions of the ICAR model, providing a measure of spatial dependence have\n  been developed [@leroux2000estimation; @dean2001detecting].\n\n- The directed acyclic graph auto-regressive (DAGAR) model [@datta2019spatial]\n  proposes a new way to construct precision matrices using a DAG derived from\n  the original adjacency matrix.\n\n:::{.notes}\n\n- CAR-like models are usually parametrized by the conditional precision.\n\n- $m_k$ = # of neighbors\n\n- $\\psi$ spatial dependence parameter\n\n- $i \\sim k$ neighbors\n\n:::\n\n## Areal Models: Limitations\n\n- [Out-of-sample predictions]{.important2}: [Non-trivial]{.important}, it may be\n  necessary to refit the model.\n\n- [Interpretability]{.important2}: Relationship between the [spatial dependence\n  parameter]{.important} and correlation between neighbors is\n  [counterintuitive]{.important}.\n\n- [Heteroscedasticity]{.important2}: [Marginal SD]{.important} depend on the\n  number of neighbors.\n\n- [Extensions]{.important} for change of support and data fusion problems are\n  [cumbersome]{.important} and there exists no consensus in the literature in\n  how to approach such problems.\n\n:::{.notes}\n\n- spatial dependence parameter can be negative and the correlation with\n  neighbors be positive.\n  \n- spatial dependence parameter very high and moderate correlation with neighbors\n\n:::\n\n## Fused Data\n\n- [GP]{.important} at the point-referrenced level and a [stochastic integral at\n  the areal level (AGP)]{.important} [@moraga2017geostatistical]:\n  $$Z(\\mathbf{s}_i) = \\begin{cases} {\\mathcal{A}(\\mathbf{s}_i)}^{-1}\n  \\int_{\\mathbf{s}_i} Z(\\mathbf{s}) \\dd \\mathbf{s}, & \\text{if }\n  \\mathcal{A}(\\mathbf{s}_i) > 0, \\\\ Z(\\mathbf{s}_i), & \\; \\text{otherwise,}\n  \\end{cases}$$\n\n- [Covariance]{.important2} [@johnson2020dealing]:\n  $$\\mathrm{Cov}(Z(\\mathbf{s}_i), Z(\\mathbf{s}_j)) = {(\\mathcal{A}(\\mathbf{s}_i)\n  \\mathcal{A}(\\mathbf{s}_j))}^{-1} \\int_{\\mathbf{s}_j} \\int_{\\mathbf{s}_i}\n  C(\\mathbf{x}, \\mathbf{y}) \\mathrm{d} \\mathbf{x} \\mathrm{d} \\mathbf{y}$$\n  \n- [Arbitrary precision]{.important2}: The stochastic integrals are evaluated\n  numerically and depend on a [user-defined grid]{.important}.\n\n## Data Fusion Models: Limitations\n\n- [Computing]{.important2}: Although satisfactory approximations exist, it\n  becomes [computationally prohibitive for moderately large\n  datasets]{.important}.\n\n- [Approximations]{.important2}: Inferences may [drastically change]{.important}\n  depending on the precision of the approximations.\n\n- [Biases]{.important2}: It is hard to quantify the [impact of the\n  discretizations on inferences]{.important} [@goncalves2018exact].\n\n## Research Questions\n\n- The main [research questions]{.important} we are interested in are:\n\n  1. Can we propose a [model for spatial data that accomodates areal,\n     point-referrenced, and fused data]{.important}?\n\n  1. If so, is this model [competitive when compared to specialized\n     models]{.important}?\n\n- [Proposal]{.important2}: A GP defined on a [flexible index set]{.important}.\n\n- [Main challenge]{.important2}: Defining a [valid correlation\n  function]{.important}.\n\n<!-- - The robustness of the method is showcased by two simulation studies and three -->\n<!--   applications. -->\n\n# Hausdorff--Gaussian Process (HGP) {.section_slide visibility=\"uncounted\"}\n\n## Distances between Sets\n\n- [Metric space]{.important2}: $(D, d)$, where $D$ is a spatial region of\n  interest.\n\n- [Distance between a point and a set]{.important2}: $d(x, A) = \\inf_{a \\in A}\n  d(x, a)$, where $d(x, y)$ is the distance between any two elements $x, y \\in\n  D$.\n\n- [Directed Hausdorff distance]{.important2}: $${\\vec h}(A, B) = \\sup_{a \\in A}\n  d(a, B)$$\n\n- [Hausdorff distance]{.important2}: $$h(A, B) = \\max \\left \\{ \\vec{h}(A, B),\n  \\vec{h}(B, A) \\right \\}$$\n\n:::{.notes}\n\n- [Symmetric Hausdorff distance]{.important2}: the greater of the two directed\n  Hausdorff distances.\n\n- Note that if $A$ and $B$ are both singletons, then $h(A, B) = d(A, B)$.\n\nMeric Properties: (1) Symmetry: $d(x, y) = d(y, x)$; (2) Nonnegativeness: $d(x,\ny) \\geq 0$ and $d(x, x) = 0$; (3)Positiveness: $d(x, y) = 0 \\implies x = y$; (4)\nTriangle inequality: $d(x, y) \\leq d(x, z) + d(z, y)$\n\n\n:::\n\n\n## Hausdorff Distance for Spatial Data Analysis\n\n- [Study region]{.important2}: In spatial statistics, $D$ is tipically a [closed\n  and bounded]{.important} subset of $\\mathbb{R}^2$.\n\n- In this context, the [Hausdorff distance is a metric]{.important}\n  [@sendov2004hausdorff].\n\n\n::: {.cell layout-ncol=\"3\"}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/haus-dist-1.png){width=960}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/haus-dist-2.png){width=960}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/haus-dist-3.png){width=960}\n:::\n:::\n\n\n:::{.notes}\n\n- Metric on $D \\setminus \\varnothing$\n\n- The Hausdorff distance ability to account for spatial units' [shapes, sizes\n  and orientation]{.important}[@min2007extended] renders it an interesting tool\n  to achieve our goals.\n\n- Moreover, it can [distinguish]{.important} between [overlapping, nested, and\n  disjointed regions]{.important}.\n\n- In the figure: (1) The dashed lines denote the Hausdorff distances; (2) The\n  infimum distance between to sets is zero for the three cases; (3) Distance\n  between centroids is the same for the first two figures.\n\n:::\n\n\n## Beyond Traditional Modeling: The HGP\n\n- [Isotropic stochastic process]{.important2}: $\\{ Z(\\mathbf{s}) \\, : \\,\n  \\mathbf{s} \\in \\mathcal{B}(D) \\},$ where $D \\subset \\mathbb{R}^2$.\n\n- [Flexible index set]{.important2}: $\\mathcal{B}(D)$ contains all [closed and\n  bounded subsets]{.important} of $D$.\n\n- [The HGP]{.important2}: The stochastic process $Z(\\cdot)$ is an HGP if:\n  - It is a GP\n  \n  - Its [correlation function is a function of the Hausdorff\n  distance]{.important} between sets (in our case, spatial units).\n\n- This process is [suitable to analyze point-referrenced, areal, and mixed\n  spatial data]{.important}.\n\n\n:::{.notes}\n\n- Ideally, we want bounded, compact, and non-empty sets for the Hausdorff\n  distance to be a metric..\n\n- In $\\mathbb{R}^2$, a compact subset is bounded.\n\n- empty is a subset of any set -> it is bounded bc a subset of a bounded set is\n  bounded itself.\n\n:::\n\n## Structure of an HGP\n\nThe HGP, denoted $\\mathrm{HGP}\\{m(\\mathbf{s}), v(\\mathbf{s}), r(h)\\}$,\nformulation depends on three functions:\n\n- The [mean]{.important} and [SD]{.important} functions, defined as\n  $$m(\\mathbf{s}) = \\E[Z(\\mathbf{s})], \\quad \\text{and} \\quad v(\\mathbf{s}) =\n  \\sqrt{\\mathrm{Var}(Z(\\mathbf{s}))},$$ respectively.\n\n- [Correlation function]{.important2}: $r(h) =\n  \\mathrm{Cor}(Z(\\mathbf{s}_1), Z(\\mathbf{s}_2)),$ where $h$ denotes the\n  [Hausdorff distance]{.important} between $\\mathbf{s}_1, \\mathbf{s}_2 \\in\n  \\mathcal{B}(D)$.\n\n- [Induced covariance function]{.important2}: $\\mathrm{Cov}(Z(\\mathbf{s}_1),\n  Z(\\mathbf{s}_2)) = v(\\mathbf{s}_1) v(\\mathbf{s}_2) r(h(\\mathbf{s}_1,\n  \\mathbf{s}_2))$\n\n:::{.notes}\n\n- Mean and SD functions can be informed by covariates.\n\n- The ensure the validity of the process, the function $r(\\cdot)$ must be\n  positive definite.\n\n- Complex functional parametric space. \n\n- Inference is simplified (or possible) by assuming parametric forms to those\n  functions.\n\n:::\n\n\n## The $v(\\mathbf{s})$ function\n\nA useful way to define this function is as follows: $$v(\\mathbf{s}) = \\exp \\{\n\\alpha_0 + \\alpha_1 w(\\mathbf{s}) \\},$$ where $w(\\mathbf{s})$ is a covariate\navailable for any $\\mathbf{s} \\in \\mathcal{B}(D)$.\n\n\n- Special cases useful in practice:\n\n    - [Homoscedastic]{.important2}: $w(\\mathbf{s}) = 0$\n\n    - [Data Fusion]{.important2}: $w(\\mathbf{s}) =\n      \\mathbb{1}(\\mathcal{A}(\\mathbf{s}) > 0)$.\n    \n    - [Area dependent]{.important2}: $w(\\mathbf{s}) = \\mathcal{A}(\\mathbf{s})$\n\n- Although flexible, one has to be [careful]{.important} when choosing this\n  function to ensure the [process validity]{.important} [@palacios2006non].\n\n\n:::{.notes}\n\n- The SD function allows the HGP to accommodate both [homoscedastic and\n  heteroscedastic scenarios]{.important}.\n\n:::\n\n## Ensuring Validity: Correlation Functions for the HGP\n\nFor a valid process, its correlation function must satisfy the following\nproperties:\n  \n- [Diminish with increasing distance]{.important2}: $\\lim_{h \\to \\infty}r(h) = 0$.\n  \n- [Bounded from above by 1]{.important2}: $r(0) = 1$.\n  \n- [Positive-definiteness]{.important2}: yields positive-definite correlation\n  matrices for all its finite-dimensional marginal distributions.\n\n- Unfortunately, functions that are guaranteed to be positive definite on\n  $(\\lVert \\cdot \\rVert_2, \\mathbb{R}^2)$ are not necessarily positive definite\n  on other metric spaces [@li2023inference].\n\n## The Powered Exponential Correlation (PEC) Function\n\n- [PEC function]{.important2}: $$r(h; \\phi, \\nu) = \\exp\\left \\{ -\n  \\frac{h^{\\nu}}{\\phi^{\\nu}}\\right \\},$$ where $\\nu$ is a [smoothness\n  parameter]{.important} and $\\phi$ governs the range of the [spatial\n  dependence]{.important}.\n\n- [Parametrization]{.important2}: We reparametrize this function with $\\rho =\n  {\\log(10)}^{1 / \\nu} \\phi$.\n\n- [Interpretation]{.important2}: $\\rho$ is the [distance]{.important} at which\n  the [spatial correlation reduces to $0.10$]{.important}.\n\n::: {.notes}\n\n- explain $\\rho$.\n\n:::\n\n## Visualizing the PEC function {visibility=\"uncounted\"}\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/pec-function-1.png){width=960}\n:::\n:::\n\n\n## Theoretical Foundation: Positive Definiteness of the PEC\n\n\n:::{.callout-note appearance=\"simple\" icon=false}\n\n## Proposition\n\nLet $h = h(\\mathbf{s}, \\mathbf{s}')$ be the Hausdorff distance between two\nspatial units, denoted $\\mathbf{s}, \\mathbf{s}' \\in \\mathcal{B}(D)$, where $D\n\\subset \\mathbb{R}^2$. The powered exponential correlation function $\\exp \\{ -\nh^{\\nu} / \\phi^{\\nu} \\}$ is positive definite for $\\nu \\in (1/2, 1)$.\n\n:::\n\n\n- The proposition above [guarantees the validity]{.important} of the\n  [HGP]{.important} equipped with a [PEC]{.important} function with $\\nu \\in\n  (1/2, 1)$.\n\n- The proof is based on embedding the Hausdorff distance into a high-dimensional\n  $L_1$ normed Euclidean space, and using the fact that the exponential\n  correlation function is positive definite on this space.\n\n## Practical Validation: Empirical Assessment of Positive Definiteness\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/psd-empirical-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n:::{.notes}\n\n- the graph displays the smallest eigenvalue of the correlation matrix induced\n  by $\\rho$ (x-axis) and $\\nu$ (y-axis).\n  \n- These matrices are based on the two spatial applications we will discuss in\n  the next chapter.\n  \n- The transparent regions indicate the regions of the parametric space where rho\n  is smaller than 0.\n\n:::\n\n## HGP Recap\n\n- [Flexibility]{.important2}: A process that handles [point-referrenced, areal,\n  and mixed spatial data]{.important} by construction.\n\n- [Hausdorff distance]{.important2}: Enables HGP's correlation function to\n  account for the [shape, size, and orientation]{.important} of spatial objects.\n\n- [Validity]{.important2}: Using a [PEC]{.important} function ensures the HGP is\n  a [valid process]{.important}.\n\n- [Next Up]{.important2}: Simulations and real-world applications will\n  demonstrate the HGP's robustness.\n\n\n```{mermaid}\nflowchart LR\n    A(Flexible index set) ==> B(GP)\n    B ==> E(((HGP)))\n    C(Hausdorff distance) ==> D(PEC)\n    D ==> E\n```\n\n\n<!-- - [GP + PEC + Hausdorff distance]{.important2}: The correlation function as a -->\n<!--   function of the asserts the shape, size and orientation of the spatial units -->\n<!--   are taken into account. -->\n\n<!-- - It is a [valid process]{.important} when using a [PEC]{.important} function. -->\n\n<!-- - Th HGP [flexibility]{.important} render it suitable for complex problems in -->\n<!--   spatial statistics. -->\n  \n<!-- - In the upcoming slides, we showcase its robustness through simulations and -->\n<!--   applications to real data. -->\n\n# Spatial modeling {.section_slide visibility=\"uncounted\"}\n\n## Outline {visibility=\"uncounted\"}\n\n- Spatial GLMM and Bayesian Inference\n\n- Simulation study for:\n  - Areal data\n  - Fused data\n  \n- Applications\n  - Areal data and disease mapping\n  - Fused data and air pollution\n\n## Notation\n\n- [Set of spatial locations]{.important2}: $\\mathcal{S} = \\{ \\mathbf{s}_1, \\ldots, \\mathbf{s}_n\n  \\}$, where $\\mathbf{s}_i \\in \\mathcal{B}(D)$ and $D \\subset \\mathbb{R}^2$.\n\n- [Response variable]{.important2}: $\\mathbf{Y} = {(Y(\\mathbf{s}_1), \\ldots,\n  Y(\\mathbf{s}_n))}^\\top$.\n\n- [Covariates]{.important2}: $\\mathbf{X} = (\\mathbf{X}_1, \\ldots, \\mathbf{X}_p)$,\n  where $\\mathbf{X}_{j} = (x_{j1}, \\ldots, x_{jn})^\\top$ and $\\mathbf{x}_i =\n  (x_{1i}, \\ldots, x_{pi})$.\n\n- [Spatial random effects]{.important2}: $\\mathbf{Z} = {(Z(\\mathbf{s}_1), \\ldots,\n  Z(\\mathbf{s}_n))}^\\top$.\n\n- [Density functions]{.important2} (for response and latent variables): $p(\\cdot \\mid \\cdot)$\n\n- [Prior and posterior distributions]{.important2}: $\\pi(\\cdot)$ and $\\pi(\\cdot\n  \\mid \\cdot)$\n\n:::{.notes}\n\n- Realizations of random variables are represented by lowercase letters.\n\n- Model paramers are greek letters.\n\n:::\n\n## Spatial GLMM\n\nA generalized linear mixed model ([GLMM]{.important}) can be written as\n$$\\begin{aligned}\n& Y(\\mathbf{s}_i) \\mid \\mathbf{x}_i, z(\\mathbf{s}_i) \\overset{{\\rm ind}}{\\sim}\n  f(\\cdot \\mid \\mu_i, \\omega) \\\\\n& g(\\mu_i) = \\mathbf{x}_i \\boldsymbol{\\beta} +\n  z(\\mathbf{s}_i).\n\\end{aligned}$$\n\n- [Probability distribution]{.important2}: $f(\\cdot)$\n\n- [Link function]{.important2}: $g(\\cdot)$\n\n- [Conditional mean]{.important2}: $\\mu_i = \\E[Y(\\mathbf{s}_i) \\mid\n  \\mathbf{x}_i, z(\\mathbf{s}_i)]$\n\n- [Model parameters]{.important2}: $\\theta = {\\{\\boldsymbol{\\beta}^\\top,\n  \\boldsymbol{\\sigma}^\\top, \\delta^\\top, \\omega^\\top \\}}^\\top$\n  \n- [Likelihood]{.important2}: $p(\\mathbf{y} \\mid \\mathbf{z}, \\theta) = \\prod_{i =\n  1}^n f(y(\\mathbf{s}_i) \\mid \\mu_i, \\omega)$\n\n:::{.notes}\n\n- Under a frequentist perspective, we consider the random effects to follow an\n  HGP.\n  \n- For Bayesian inference, we use the HGP as a prior for the random effects.\n\n- Response variable $Y$ at a spatial unit $s$ is modeled with an appropriate\n  distribution (e.g., Poisson, Bernoulli).\n\n- Covariates ($X$) and spatial random effects ($Z$) explain variation in the\n  conditional mean ($\\mu$).\n\n- The HGP defines the spatial random effects ($Z$), capturing spatial\n  correlation with the Hausdorff distance and a correlation function.\n\n:::\n\n## Bayesian Estimation\n\n- [Priors]{.important2}: [$\\mathbf{Z} \\sim \\mathrm{HGP}\\{0, v(\\cdot), r(\\cdot)\n  \\}$]{.important}, $\\boldsymbol{\\beta} \\sim \\mathcal{N}(\\mathbf{0}, 10^2\n  \\mathbf{I})$, $\\rho \\sim \\mathrm{Exp}(a_\\rho)$, $\\nu = 0.7$.\n  - Homoscedastic model ($v(\\mathbf{s}) = \\sigma$): $\\sigma \\sim t_{+}(3)$\n  - Heteroscedastic model ($\\log(v(\\mathbf{s})) = \\alpha_0 + \\alpha_1\n    w(\\mathbf{s})$): $(\\alpha_0, \\alpha_1)^\\top \\sim \\mathcal{N}(\\mathbf{0}, 10^2\n    \\mathbf{I})$\n\n- [Posterior]{.important2}: $\\pi(\\theta \\mid \\mathbf{y}, \\mathbf{z}) \\propto\n  p(\\mathbf{y} \\mid \\mathbf{z}, \\theta) p(\\mathbf{z} \\mid \\theta) \\pi(\\theta)$\n\n- [MCMC sampler]{.important2}: No-U-Turn [@hoffman2014no].\n\n- [Convergence assessment]{.important2}: traceplots and split-${\\hat{R}}$\n  [@vehtari2021rank].\n\n:::{.notes}\n\n- Point and interval estimates: median and percentiles ($0.025$\n  and $0.975$) of the marginal MCMC samples.\n  \n- Parameters initialized by random sampling from their priors.\n\n- Random effects initialized from a standard normal distribution.\n\n- $a_\\rho$ is chosen so that: $\\mathbb{P}(\\rho > U) = p_\\rho$. In particular,\n  $a_\\rho = - \\log(p_\\rho) / \\rho_0$.\n\n- $\\nu$ hard to be estimated.\n\n:::\n\n## Goodness-of-fit and Predictions\n\n- [Goodness-of-fit criteria]{.important2}: DIC, WAIC, and LOOIC ([lower values\n  indicate better fit]{.important})\n\n  - $\\Delta_G = G(\\text{M}) - G(\\text{HGP})$, where $G$ is a model\n    comparison criterion and $M$ is a competing method.\n\n- [Unobserved outcome at $m$ locations]{.important2}: $\\mathbf{Y}^\\ast =\n  (y(\\mathbf{s}^\\ast_1), \\ldots, y(\\mathbf{s}^\\ast_m))^\\top$.\n\n- [Posterior predictive distributions]{.important2}: $p(\\mathbf{y}^{\\ast} \\mid\n  \\mathbf{y}) = \\int p(\\mathbf{y}^{\\ast} \\mid \\mathbf{z}^{\\ast}, \\theta)\n  p(\\mathbf{z}^{\\ast} \\mid \\mathbf{z}, \\theta) \\pi(\\theta \\mid \\mathbf{y}) {\\rm\n  d} \\theta$\n\n- Monte Carlo samples from $p(\\mathbf{y}^{\\ast} \\mid \\mathbf{y})$ are obtained\n  using the draws from the posterior $\\pi(\\theta \\mid \\mathbf{y})$\n\n:::{.notes}\n\n- $\\Delta_G > 0$ favors the proposed method.\n\nPredictions:\n\n1. use the properties of GP and multivariate Normal distribution to obtain the\n   closed-form distribution of the vector of spatial random effects\n   $\\mathbf{Z}^\\ast$ [@diggle1998model];\n\n2. sample $\\mathbf{z}^\\ast_{(b)}$ from the distribution derived in the previous\n   step;\n\n3. sample $\\mathbf{y}^{\\ast}_{(b)}$ from $p(\\mathbf{y}^{\\ast} \\mid \\theta_{(b)},\n   \\mathbf{z}^{\\ast}_{(b)})$, where $\\theta_{(b)}$ is the $b$-th MCMC sample of\n   $\\theta$.\n\n:::\n\n\n## Simulation Studies: Setup\n\n- [Goal]{.important2}: Evaluate HGP's ability to adapt to different scenarios\n  and [compare its performance to specialized models]{.important}.\n\n- [200 simulated datasets]{.important2} for each combination of data generation\n  process and scenario.\n\n- [Estimation assessment]{.important2}: MAPE, RMSE, frequentist coverage of the credible\n  interval (CP).\n  \n- [Predictions assessment]{.important2}: bias, RMSP, interval score [@gneiting2007strictly,\n  IS], frequentist coverate of the prediction intervals (CPP).\n\n:::{.notes}\n\n> Overview: Emphasize the motivation behind the simulations – to demonstrate the\n> HGP's ability to handle realistic scenarios and to compare its performance to\n> established spatial models. Explain that simulations provide a controlled\n> environment to assess model behavior.\n\n- Simulated data on different maps and under different generating models. For\n  each combination of map (data configuration) and generating model, we simulate\n  200 datasets.\n\n- Parameter used to simulate data were set to resemble the applications.\n\n- IS: ${\\rm IS}(y; l, u) = u - l + \\frac{2}{\\alpha} (l - y) \\mathbb1}\\{ y < l\n  \\} + \\frac{2}{\\alpha} (y - u) \\mathbb1}\\{ y > u \\}$\n\n- IS takes into account the width of the prediction intervals (PI) and a\n  penalization factor proportional to how far a PI is from its target.\n\n:::\n\n\n## Simulation Studies: Scenarios\n\n\n::: {.cell layout-ncol=\"2\" crop='true'}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/simscen-1.png){width=960}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/simscen-2.png){width=960}\n:::\n:::\n\n\n## Simulation Study: Areal Data\n\n- [Data model]{.important2}: Poisson GLMM, single covariate, log link function,\n  and a spatial random effect.\n\n- We fit Poisson GLMMs with a [homoscedastic HGP]{.important} prior on the\n  random effect.\n\n- [Assessment]{.important2}:\n  - Parameter [estimation]{.important} when [generating data from\n    HGP]{.important} random effects.\n  - How good are the estimates of the [regression coefficient]{.important} under\n    [random effect misspecification]{.important}?\n  - [Goodness-of-fit comparison with DAGAR]{.important} priors on the random\n    effect.\n\n:::{.notes}\n\n> Overview: Explain how areal data is simulated to mimic real-world\n> complexities. Clearly distinguish between using the HGP for simulation and for\n> fitting. Briefly outline the BYM model as a comparison point.\n\n- Describe data generation processes: aggregated GPs, BYM models.\n\n- DAGAR state-of-art specialized model\n\n- Highlight the use of maps with different spatial configurations.\n\n:::\n\n## Areal Random Effects\n\n- [Data Generation]{.important2}:\n\n  - [Besag-York-Mollié [BYM, @besag1991bayesian]]{.important}: $\\mathbf{Z} \\sim\n    \\mathcal{N}(\\mathbf{0}, \\sigma^{2}((1 - \\zeta) \\mathbf{I} + \\zeta\n    \\mathbf{Q}^{-})$, where $\\mathbf{Q}$ is the precision matrix from the ICAR\n    model and $\\zeta$ is a mixing parameter.\n  - [Aggregated GP (AGP)]{.important}: $Z(\\mathbf{s}_i) =\n    {\\mathcal{A}(\\mathbf{s}_i)}^{-1} \\int_{\\mathbf{s}_i} K(\\mathbf{s}) \\dd\n    \\mathbf{s}$, where $\\{ K(\\mathbf{s}) \\, : \\, \\mathbf{s} \\in D \\}$ is a\n    (point-level) zero-mean, second order stationary and isotropic GP.\n\n- [Competing Method]{.important2}:\n\n  - [DAGAR]{.important}: $\\mathbf{Z} \\sim \\mathcal{N}(\\mathbf{0}, \\Lambda(\\tau,\n    \\psi))$, where $\\Lambda$ is a precision matrix, $\\tau$ is the conditional\n    precision, and $\\psi$ measures spatial dependence.\n\n:::{.notes}\nDAGAR priors:\n$$\n\\begin{aligned}\n  \\pi(\\beta_0) & \\propto 1 \\\\\n  \\beta_1 & \\sim N(0, 1000^2) \\\\\n  \\tau & \\sim Gamma(2, 1) \\\\\n  \\psi & \\sim U(0, 1).\n\\end{aligned}\n$$\n- Precision matrix is defined based on the order of the observations and\nadjacency matrix (and the two parameters)\n:::\n\n## Areal Simulation: Estimation\n\n- [Generating data from HGP]{.important2}:\n\n  - CP of the hardest parameter to estimate ($\\rho$) was $92.5\\%$ in the worst\n    case scenario.\n  - For all the other parameters, the [coverage was extremely close to the\n    nominal level]{.important}.\n\n- [Regression parameter under misspecification]{.important2}: \n\n  - Largest (worst) MAPE was $6.6\\%$. \n  - CP of the credible interval [suggests reliable estimates]{.important}.\n\n:::{.notes}\n\n- Worst performance under scenario 3. This may be explained by the fact that we\n  fit an homoscedastic model and the two generating processes are\n  heteroscedastic under that scenario.\n\n:::\n\n## Areal Simulation: GOF\n\n\nHGP [outperforms DAGAR]{.important} when simulating data from a AGP random\neffect.\n\n\n\n::: {.cell layout-align=\"center\" crop='true'}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/agof-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n:::{.notes}\n\n- For DIC we always win.\n\n:::\n\n## Simulation Study: Data Fusion\n\n- [Data model]{.important2}: Gaussian GLMM, no covariates, identity link\n  function, and a spatial random effect.\n\n- We fit the models with a [heteroscedastic HGP]{.important} as prior on the\n  random effect.\n\n- [Competing method]{.important2}: [AGP~1~ and AGP~2~]{.important} priors on the\n  random effect. The latter employes a finer grid/mesh resolution to approximate\n  integrals numerically.\n\n- [Parameters estimation]{.important2} when [generating data from\n  HGP]{.important} random effects.\n\n- [Model comparison]{.important2}: Predictions assessment.\n\n:::{.notes}\n\n> Overview: Highlight the unique aspect of data fusion simulations – working\n> with different spatial data types. Explain the competing models and why\n> they're relevant comparisons. Stress the importance of accurate predictions\n> and uncertainty assessment in data fusion contexts.\n\n- point-referrenced data have different SDs\n\n- PC prior on $\\tau$.\n\n:::\n\n## Competing Method: Meshes  {.section_slide visibility=\"uncounted\"}\n\n\n::: {.cell layout-ncol=\"2\" layout-align=\"center\" crop='true'}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/meshes-sim-1.png){fig-align='center' width=960}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/meshes-sim-2.png){fig-align='center' width=960}\n:::\n:::\n\n\n## Competing Method: Further Details {visibility=\"uncounted\"}\n\n- The model employs a [Matérn covariance]{.important} function (at point level)\n  with smoothness parameter fixed at 1. The other two parameters are the SD\n  $\\sigma$ and the practical range $\\rho$. Both are analogous to the parameters\n  with the same name in the HGP model.\n\n- Inferences are conducted using the [INLA]{.important} [@rue2009approximate]\n  and the stochastic partial differential equation [@lindgren2011explicit, SPDE]\n  method.\n\n\n## Data Fusion Simulation: Estimation\n\n- The HGP inherits same [problems from geostatistical]{.important} models.\n\n- There are no weakly consistent estimators for the variance and spatial\n  dependence parameters  [@zhang2004inconsistent]\n  \n- Predictions are still optimal [@zhang2004inconsistent]\n\n- The small scale variation parameter had a low coverage in the credible\n  intervals ($79.5\\%$ for scenario 2).\n  \n- The MAPE for the $\\sigma$, $\\sigma_a$, and $\\rho$ parameters fluctuated around\n  $10\\%$ in both scenarios.\n\n:::{.notes}\n\n- Consistency and concentration of the posteiors Schervish.\n\n- This limitations partially explains the estimation results.\n\n:::\n\n## Data Fusion Simulation: Prediction\n\n- [Uncertainty of the predictions]{.important2}: The [HGP handles\n  uncertainty]{.important} in its [predictions]{.important} better than the\n  AGP~1~ model, even when the latter reflects the true data generation process.\n\n<!-- - [Prediction Intervals]{.important2}: AGP~1~ models tend to have low coverage -->\n<!--   in prediction intervals, underestimating potential variability. -->\n\n- [HGP as an AGP Approximation]{.important2}: **The HGP delivers satisfactory\n  approximations to an AGP model**.\n\n- [HGP Advantages]{.important2}: The HGP offers potential [computational\n  advantages]{.important} for large datasets while maintaining [clear parameter\n  interpretation]{.important}.\n\n:::{.notes}\n\n- Point Estimates: AGP~2~ model consistently deliver point estimates (single\n  value predictions) with minimal bias.\n\n- The proposed methodology excelled in the predictions.\n\n- AGP~1~ underestimating variability: evident in both correctly specified and\n  misspecified cases.\n\n- HGP avoids the need for defining a grid resolution used in numerical\n  calculations.\n\n:::\n\n## Respiratory Disease Hospitalization\n\n- [Sample units]{.important2}: 134 intermediate zones (IZ), where the $i$-th IZ\n  is denoted $\\mathbf{s}_i$.\n\n- [Number of hospitalizations]{.important2}: $\\mathbf{Y} = {(Y(\\mathbf{s}_1),\n  \\ldots, Y(\\mathbf{s}_n))}^\\top$.\n\n- [Expected number of hospitalizations]{.important2} based on the national age-\n  and sex-standardized rates: $E_i$.\n\n- [Percentage of people]{.important2} classified as [income\n  deprived]{.important2}: $\\mathbf{X}$.\n\n$$\\begin{aligned}\n& (Y(\\mathbf{s}_i) \\mid x_i, z(\\mathbf{s}_i)) \\sim \\text{Poisson}(E_i \\mu_i) \\\\\n& \\log(\\mu_i) = \\beta_0 + x_i \\beta_1 + z(\\mathbf{s}_i)\n\\end{aligned}$$\n\n:::{.notes}\n\n- Data from the north portion of the river Clyde in the Great Glasgow and Clyde\n  health board in Scotland.\n\n- Assumption: Conditional on $\\mathbf{Z}$, $\\mathbf{Y}$ are mutually\n  independent.\n\n- Explain goals of the analysis--estimate risks adjusted for income deprivation,\n  compare methods.\n\n- $\\mu_i$ is the expected SIR at region $i$.\n\n- Outline the modeling choices (HGP, DAGAR, BYM), briefly mention priors.\n\n:::\n\n## Standardized Incidence Ratio (SIR)\n\n\n::: {.cell layout-align=\"center\" crop='true'}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/sir-scot-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n## Disease Mapping: GOF\n\n|       | HGP    | DAGAR      | BYM        |\n|:------|:------:|:----------:|:----------:|\n| LOOIC | [1081.5]{.important} | 1084.0       | 1091.1 |\n| WAIC  | 1038.7 |[1032.2]{.important} | 1041.1     |\n| DIC   | [1048.8]{.important} | 1050.4     | 1050.6 |\n\n: {.striped}\n\n\n::: {.cell layout-align=\"center\" crop='true'}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/sirfit-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n:::{.notes}\n\n\n- Better fit in 2 out of 3 metrics\n\n- Fitted values are similar among the three models\n\n- Some regions with very low risks are shrunk toward a \"regional mean\"\n\n:::\n\n## Disease Mapping: Estimation {.center}\n\n:::{.fw}\n\n|     | HGP                        | DAGAR                      | BYM                        |\n|:---:|:--------------------------:|:--------------------------:|:--------------------------:|\n| $\\beta_0$ | --0.208 (--0.265, --0.127) | --0.261 (--0.459, --0.140) | --0.219 (--0.257, --0.183) |\n| $\\beta_1$ | 0.325 (0.285, 0.366)       | 0.313 (0.258, 0.370)       | 0.326 (0.286, 0.367)       |\n| $\\sigma$  | 0.190 (0.154, 0.242)       | 0.300 (0.217, 0.489)       | 0.238 (0.176, 0.347)       |\n| $\\rho$    | 2.360 (0.140, 8.144)       |                            |                            |\n| $\\psi$    |                            | 0.435 (0.063, 0.830)       |                            |\n| $\\zeta$   |                            |                            | 0.428 (0.101, 0.811)       |\n\n: {.striped}\n\n:::\n\n:::{.notes}\n\n- median (95% CI)\n\n- similar estimates for covariate\n\n- HGP indicates weak spatial correlation\n\n- DAGAR and BYM spatial dependence are not helpful as they indicate the spatial\n  correlation goes from weak to strong (according to the CI)\n\n:::\n\n## Disease Mapping: Spatial Dependence\n\n\n::: {.cell layout-align=\"center\" crop='true'}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/scotrho-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n:::{.notes}\n\n- HGP provides more insight into spatial dependence\n\n- We could also plot the correlation function itself\n\n:::\n\n## Disease Mapping: Insights\n\n- [HGP Advantages]{.important2}: The HGP provides a simpler and [more\n  intuitive]{.important} understanding of [spatial dependence]{.important}\n  compared to classical methods.\n\n- [Assumptions]{.important2}: The HGP's core assumptions about spatial\n  relationships differ from those used in specialized models for areal data.\n\n- [Spatial Correlation]{.important2}: In the HGP, spatial correlation decreases\n  as the Hausdorff distance between areas increases.\n\n- [Specialized Models Complexity]{.important2}: Areal data models often rely on\n  more complex spatial relationships based on detailed factors like shared\n  borders and the number of neighboring units.\n\n\n## Data Analysis: Air Pollution in Ventura and Los Angeles\n\n::: {layout=\"[ 0.5, -0.05, 0.45 ]\"}\n\n::::{#first-column}\n\n- [Point-referrenced data]{.important2} from 19 measurement stations available\n  daily from 1999 to date;\n\n- [Satellite-derived]{.important2} estimates (2010--2012) at 184 areal units.\n\n- [PM~2.5~]{.important2}: $\\mathbf{Y} = {(Y(\\mathbf{s}_1), \\ldots,\n  Y(\\mathbf{s}_n))}^\\top$.\n\n- [Model]{.important2}: $(Y(\\mathbf{s}_i) \\mid z(\\mathbf{s}_i)) \\sim\n  \\mathcal{N}(\\beta_0 + z(\\mathbf{s}_i), \\tau^2)$\n\n::::\n\n::::{#second-column}\n\n\n::: {.cell layout-align=\"center\" crop='true'}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/pm25-map1-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n::::\n\n:::\n\n:::{.notes}\n\n- goals: (1); estimate model parameters using both sources. (2) use satellite\n  data to help with interpolation.\n\n- square areas (average size $\\approx$ 101.95 km^2^)\n\n- data fusion challenges\n\n- adaptability of the hgp to different problems.\n\n- Pm25 scale is micrometre per cubic meter: one one-millionth of a meter.\n\n- conditional on $z$ the $y$s are mutually independent.\n\n- Priors on random effects: AGP1 and 2; heteroscedastic HGP with different\n  variances for areal and point-referrenced data.\n\n:::\n\n## Air Pollution: Meshes  {.section_slide visibility=\"uncounted\"}\n\n\n::: {.cell layout-ncol=\"2\" layout-align=\"center\" crop='true'}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/meshes-lam-1.png){fig-align='center' width=960}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/meshes-lam-2.png){fig-align='center' width=960}\n:::\n:::\n\n\n## Air Pollution: GOF and 10-fold CV\n\n:::{.xycenter}\n\n|       | HGP    | AGP~1~ | AGP~2~ |\n|:------|:------:|:------:|:------:|\n| LOOIC | 505.1  | 746.7  | [--473.5]{.important} |\n| WAIC  | 507.2  | 745.3  | [--876.2]{.important} |\n| DIC   | 468.7  | 740.7  | [--819.3]{.important} |\n\n: {.striped}\n\n:::\n\n## Air Pollution: GOF and 10-fold CV {transition=\"zoom-in slide-out\" transition-speed=\"slow\" visibility=\"uncounted\"}\n\n:::{.fw}\n\n| Type    | Model  |       Bias |      RMSP |         IS |\n|:-------|:-------|-------:|-------:|-------:|\n| Overall | HGP    |    --0.019 | [0.214]{.important} |  [4.802]{.important} |\n|         | AGP~1~ | [--0.005]{.important}|     0.333 |     15.114 |\n|         | AGP~2~ |    --0.281 |     0.525 |     13.648 |\n| Point   | HGP    | [--0.718]{.important}| [2.048]{.important} | [12.686]{.important} |\n|         | AGP~1~ |    --3.298 |     3.829 |    111.838 |\n|         | AGP~2~ |    --3.536 |     4.095 |     45.034 |\n| Polygon | HGP    |  [0.003]{.important} | [0.111]{.important} |  [3.829]{.important} |\n|         | AGP~1~ |      0.301 |     0.324 |      6.034 |\n|         | AGP~2~ |      0.015 |     0.251 |     10.918 |\n\n: {.striped}\n\n:::\n\n## Air Pollution: Estimation {.center}\n\n:::{.fw}\n\n|     | HGP                        | AGP~1~                     | AGP~2~                     |\n|:---:|:--------------------------:|:--------------------------:|:--------------------------:|\n| $\\beta$    | 5.605 (4.688, 6.449) | 6.219 (2.160, 10.100)     | 6.187 (5.879, 6.478)       |\n| $\\rho$     | 1.383 (0.782, 2.36)  | 1.316 (0.514, 3.024)      | 0.063 (0.046, .083)        |\n| $\\sigma$   | 3.849 (2.921, 5.181) | 1.703 (0.960, 2.910)      | 2.399 (2.024, 2.837)       |\n| $\\tau$     | 0.178 (0.073, 0.312) | 1.394 (1.242, 1.563)      | 0.539 (0.394, 0.719)       |\n| $\\sigma_a$ | 1.241 (1.037, 1.505) |                           |                            |\n\n: {.striped}\n\n:::\n\n:::{.notes}\n\n- $\\rho$ rescaled to 100s of km.\n\n- staggering difference in estimates of the same model with different meshes.\n\n:::\n\n## Air Pollution: Change-of-Support\n\n\n\n::: {.cell layout-align=\"center\" crop='true'}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/lacos-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n:::{.notes}\n\n- Figure confirms what we learned from 10-fold CV and simulation studies.\n\n- HGP allows to use data from different sources seamlessly\n\n- No dependence on meshes/grids\n\n- Apparently, a parsimonious compromise between the two meshes.\n\n- Once again, the AGP seems highly dependend on the mesh and this is not\n  highlighted in the literature.\n\n:::\n\n## Highlights\n\n- [Flexibility \\& Interpretability]{.important2}: Models [diverse spatial\n  data]{.important} types and provides [meaningful spatial\n  parameters]{.important}, regardless of unit size or shape.\n\n- [Predictions]{.important2}: The HGP delivers [accurate predictions]{.important}\n\n- [Areal Data]{.important2}: The model delivers valuable insights on the spatial\n  dependence and accounts for sample units' size, shape, and orientation.\n\n- [Data Fusion]{.important2}: The HGP [simplifies the modeling]{.important}\n  process eliminating the need of a user-defined grid or mesh. Consequently,\n  [avoids computationally intensive]{.important} numerical integrations with\n  arbitrary precision, making inference seamless.\n  \n\n# Spatiotemporal modeling {.section_slide visibility=\"uncounted\"}\n\n## Tuberculosis in Brazil\n\n- [TB in Context]{.important2}: Tuberculosis (TB) remains a major global health\n  threat, second in infectious disease mortality only to COVID-19.\n  \n- [Brazilian TB Trends]{.important2}: Brazil's national TB incidence declined\n  only slightly from 2006--2015. Rio Grande do Sul (RS) reported significantly\n  higher incidence than the national average in 2021, with the eastern region\n  even more affected.\n\n- [Spatial Dependence]{.important2}: Studies demonstrate strong spatial\n  dependence of TB infections (and co-infections) in Brazil, both nationwide and\n  in specific cities. Time dependence has been largely overlooked in the\n  literature.\n\n- [Risk Factors]{.important2}: TB risk factors include densely populated areas,\n  poverty, substance abuse, and incarceration.\n\n:::{.notes}\n\n- airborne infectious disease\n\n- We focus on 54 municipalities in the Eastern part of the state (briefly\n  explain why: zero-inflation, big n.)\n\n:::\n\n## Objectives\n\n- [Reliable incidence estimates]{.important2}:\n  - TB incidence across the study period, incorporating location-specific\n    factors.\n  - Smaller municipalities benefit from \"borrowed strength\" based on Hausdorff\n    distance from neighbors, improving estimate reliability.\n  - Results enable the calculation of SIRs to pinpoint high-risk areas.\n\n- [Forecasts]{.important2}:\n  - TB incidence rates one year ahead.\n  - These predictions offer crucial insights for proactive public health planning.\n\n<!-- ## TB over time -->\n \n<!-- ```{r} -->\n<!-- #| label: ttrend -->\n<!-- #| file: fig-ttrend.R -->\n<!-- #| crop: true -->\n<!-- #| fig-align: center -->\n<!-- ``` -->\n\n## Model\n\n- [Sample units]{.important2}: 54 municipalities, across 11 years (2011 to\n  2021). We use 2022 to assess the quality of predictions.\n\n- [Number of TB cases]{.important2}: $Y_t(\\mathbf{s}_i) = Y(\\mathbf{s}_i, t)$ at\n  location $\\mathbf{s}_i$ and time $t$.\n\n- [Population]{.important2}: $P_t(\\mathbf{s}_i)$.\n\n- Five covariates and two way [interactions between presence of\n  prison]{.important2} and continuous variables (except IDESE).\n\n- The priors are the same as in the spatial setting. Here, we also placed a\n  prior on $\\nu$.\n\n$$\\begin{aligned}\n& (Y_t(\\mathbf{s}_i) \\mid \\mathbf{X}_{t}(\\mathbf{s}_i), z_t(\\mathbf{s}_i))\n  \\overset{{\\rm ind}}{\\sim}\n  \\text{Poisson}(P_t(\\mathbf{s}_i) \\mu_{it}) \\\\\n& \\log(\\mu_{it}) = \\beta_0 + \\mathbf{X}^\\top_{t}(\\mathbf{s}_i) \\beta + z_t(\\mathbf{s}_i)\n\\end{aligned}$$\n\n:::{.notes}\n\n- $\\mu_it$: rate\n\n- A weakly informative Beta prior with mode at 0.75 and standard deviation\n  around 0.22.\n\n- Prior sensitivity using Importance Sampling and power-scaling.\n\n:::\n\n## Spatiotemporal Trend\n\n\n::: {.cell layout-align=\"center\" crop='true'}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/sptrend-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n:::{.notes}\n\n- - Another COVARIATE: Presence of prison. Around 24\\% of the municipalities had\n  at least one prison. Incarcerated population was not available at a yearly\n  basis.\n\n- Cases per 100k inhabitants.\n\n- 2015 and 2016: 2014 - World Cup; 2016 Olympic Games.\n\n- 2019 COVID. \n\n- In general, we can see a spatial pattern and a decreasing trend.\n\n:::\n\n\n## Explanatory Variables\n\n\n::: {.cell layout-align=\"center\" crop='true'}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/sptcovars-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n:::{.notes}\n\n- pop. dens: log and then scaled.\n\n- idese: scaled (IDESE is released yearly in RS and it is similar to IDH).\n\n- homicide rates: EB then log-transformed then scaled\n\n- HSDR: scaled.\n\n- Transformations: Avoiding long-tails and highly influential observations\n\n:::\n\n\n## Random Effects\n\n- No random effects\n\n- [Unstructured]{.important2}: Random intercept per municipality (iid Normal)\n\n- [Time dependent]{.important2}: $\\mathrm{AR}(1)$\n\n- [Spatial]{.important2}: Homoscedastic HGP\n\n- [Separable spatiotemporal]{.important2}: $\\mathrm{AR}(1)$ + Homoscedastic HGP, Multivariate\n  $\\mathrm{AR}(1)$ with HGP errors\n\n- [Separable spatiotemporal and unstructured]{.important2}: Multivariate\n  $\\mathrm{AR}(1)$ with HGP errors + random intercept per municipality\n\n\n:::{.notes}\n\n- Model comparison criteria are the same as in the last chapter\n\n- PC prior for the AR coefficient\n\n- Best model was the more complex (by a lot)\n\n- Compared results with analogous models having other spatial structures\n\n:::\n\n## Results: GOF and Predictive Performance\n\n:::{.r-fit-text}\n\n|       | LOOIC                | WAIC                 | DIC                  |RMSP      | IS        |\n|:------|:------:|:------:|:------:|:------:|:------:|\n| BYM   | 3606.1               | 3449.9               | 3505.4               |123.3     | 176.6     |\n| DAGAR | 3520.9               | [3447.5]{.important} | [3443.6]{.important} | 22.4      | 88.8      |\n| HGP   | [3516.1]{.important} | 3447.7               | 3450.4               |[21.1]{.important} | [87.8]{.important} |\n\n: {.striped}\n\n:::\n\n:::{.notes}\n\n- HGP vs. Specialized Models: When compared to specialized models like DAGAR,\n  the HGP demonstrates highly competitive GOF performance.\n\n- Minor Differences: While DAGAR slightly outperformed on some fit criteria, the\n  overall goodness-of-fit differences between the HGP and DAGAR were minimal.\n\n- Predictive Power: The HGP excels in predictive performance, outperforming\n  competitors on both RMSP (point prediction accuracy) and IS (interval\n  prediction accuracy).\n\n:::\n\n## Results: Relative Risks\n\n:::{.fw}\n\n| Parameter                    | Estimate          |\n|:-----------------------------|:-----------------------------:|\n| $\\exp(\\beta_1)$              | 2.34 (1.70, 3.19) |\n| $\\exp(\\beta_2)$              | 1.33 (1.15, 1.56) |\n| $\\exp(\\beta_3)$              | 1.03 (0.99, 1.07) |\n| $\\exp(\\beta_4)$              | 0.97 (0.93, 1.00) |\n| $\\exp(\\beta_5)$              | 0.99 (0.92, 1.07) |\n| $\\exp(\\beta_2 + \\beta_{21})$ | 1.75 (1.18, 2.52) |\n| $\\exp(\\beta_3 + \\beta_{31})$ | 2.25 (1.63, 3.09) |\n| $\\exp(\\beta_4 + \\beta_{41})$ | 2.51 (1.83, 3.46) |\n\n: {.striped}\n\n:::\n\n:::{.notes}\n\n- relative risk estimates derived from regression coefficients.\n\n- (1): dummy for prison presence; (2) pop/km^2^; (3) homicides; (4) high school;\n  (5) IDESE;\n\n- Double-digit indices represent interactions between variables\n\n- Municipalities with prisons have a 2.34 times higher average TB incidence,\n  even when controlling for other factors.\n\n- homicide rates and hsdr not important in prison-free municipalities but worsen\n  the risk in municipalities with prisons.\n\n:::\n\n\n## Spatiotemporal Dependence\n\n\n::: {.cell layout-align=\"center\" crop='true'}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/sptcorr-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n:::{.notes}\n\n- Importance of spatiotemporal term\n\n- Without the municipality random intercept we get even stronger spatial dependence.\n\n- Not possible to make such graph for other areal models.\n\n:::\n\n## Small Municipalities\n\n\n::: {.cell layout-align=\"center\" crop='true'}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/sptshrink-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n## Forecast\n\n\n::: {.cell layout-align=\"center\" crop='true'}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/sptpred-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n## Forecast {visibility=\"uncounted\"}\n\n\n::: {.cell layout-align=\"center\" crop='true'}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/sptpop-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n## Highlights\n\n- **Tailored an HGP extension for spatiotemporal disease mapping.**\n\n- [Competitive]{.important2} with specialized models\n\n- It helps to gain insights into spatiotemporal disease mapping through\n  spatiotemporal correlation functions.\n\n- More reliable [estimates of risk factors]{.important}\n\n- [Out-of-sample predictions]{.important2} to inform public policies\n\n\n# Closing remarks {.section_slide visibility=\"uncounted\"}\n\n## Conclusion\n\nThe [HGP offers a powerful and versatile model]{.important} for spatial\nanalysis. Advantages include:\n\n- Common framework for diverse spatial data types.\n\n- Competitive performance when compared to specialized models.\n  \n- Directly interpretable spatial parameters.\n\n- Reliable and accurate predictions.\n\n## Future work and Limitations\n\n- [Extensions]{.important2}: \n  - non-Euclidean spaces\n  - Big data\n\n- [Limitations]{.important2}: \n  - Difficulties in obtaining spectral densities for correlation functions\n  - Big \"n\" problem inherited from geostatistics\n  - Unclear how to incorporate anisotropy \n\n---\n\n### References {visibility=\"uncounted\"}\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}