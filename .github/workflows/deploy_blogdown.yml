on:
  push:
     branches:
       - master

name: blogdown_ga

jobs:
  blogdown:
    name: Render-Blog
    runs-on: ubuntu-latest ## macOS-latest
    env:
      GITHUB_PAT: ${{ secrets.GITHUB_TOKEN }}
    steps:
    - name: Checkout repo
      uses: actions/checkout@v2

    - name: Setup R
      uses: r-lib/actions/setup-r@v1

    - name: Install pandoc and pandoc citeproc
      run: |
        brew install pandoc
    - name: Cache Renv packages
      uses: actions/cache@v2
      with:
        path: $HOME/.local/share/renv
        key: r-${{ hashFiles('renv.lock') }}
        restore-keys: r-

    - name: Install packages
      run: |
        R -e 'install.packages("renv")'
        R -e 'renv::restore()'
    - name: Install hugo
      run: |
        R -e 'blogdown::install_hugo()'
    - name: Build site
      run: |
        R -e 'blogdown::build_site(TRUE)'
    - uses: actions/upload-artifact@v1
      with:
        name: public
        path: public/

    - name: Deploy 
      uses: JamesIves/github-pages-deploy-action@3.7.1
      with:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        BRANCH: gh-pages # The branch the action should deploy to.
        FOLDER: public # The folder the action should deploy.
        CLEAN: true # Automatically remove deleted files from the deploy branch

## Need to first create an empty gh-pages branch
## see https://pkgdown.r-lib.org/reference/deploy_site_github.html
## and also add secrets for a GH_PAT and EMAIL to the repository
## gh-action from Cecilapp/GitHub-Pages-deploy
  ## checkout-and-deploy:
  ##  runs-on: ubuntu-latest
  ##  needs: blogdown
  ##  steps:
  ##    - name: Checkout
  ##      uses: actions/checkout@master
  ##    - name: Download artifact
  ##      uses: actions/download-artifact@v1.0.0
  ##      with:
  ##        # Artifact name
  ##        name: public # optional
  ##        # Destination path
  ##        path: public/ # optional
  ##    - name: Deploy to GitHub Pages
  ##      uses: Cecilapp/GitHub-Pages-deploy@v3
  ##      env:
  ##         GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  ##     with:
  ##         email: lucasdac.godoy@gmail.com
  ##         build_dir: public/
  ##         branch: gh-pages
  ##         cname: lcgodoy.me 
  ##         jekyll: no

# gh-action from Cecilapp/GitHub-Pages-deploy
  ## checkout-and-deploy:
  ##  runs-on: ubuntu-latest
  ##  needs: blogdown
  ##  steps:
  ##    - name: Checkout
  ##      uses: actions/checkout@master
  ##    - name: Download artifact
  ##      uses: actions/download-artifact@v1.0.0
  ##      with:
  ##        # Artifact name
  ##        name: public # optional
  ##        # Destination path
  ##        path: public # optional
  ##    - name: Deploy to GitHub Pages
  ##      uses: Cecilapp/GitHub-Pages-deploy@v3
  ##      env:
  ##         GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  ##         BUILD_DIR: public/
  ##      with:
  ##        email: lucasdac.godoy@gmail.com
  ##        ## branch: gh-pages
  ##        cname: lcgodoy.me
  ##        jekyll: no
