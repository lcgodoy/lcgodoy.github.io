---
title: |
  HAUSDORFF--GAUSSIAN PROCESS WITH SPATIAL AND SPATIOTEMPORAL APPLICATIONS
author:
  - name: Lucas da Cunha Godoy
    orcid: 0000-0003-4265-972X
    affiliations: Department of Statiscis, UConn
date: 2024-04-10
bibliography: references.bib
csl: asa.csl
format:
  revealjs:
    theme: [my-theme.scss]
    output-file: defense.html
    embed-resources: true
    self-contained-math: true
    toc: true
    toc-depth: 1
    smaller: false
    slide-number: c/t
    navigation-mode: linear
    html-math-method:
      method: mathjax
      url: "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML"
---


# Introduction {.section_slide visibility="uncounted"}

"Everything is related to everything else, but near things are more
related than distant things."
---Tobler's first law of geography

##  Spatial Data

\newcommand\indicator{1\kern-0.25em\text{l}}
\newcommand\REALS{1\kern-0.2em\text{R}}
\newcommand\E{\mathbb{E}}
\newcommand\dd{\mathrm{d}}

```{r}
knitr::knit_hooks$set(crop = knitr::hook_pdfcrop)
```

- Taking into account [spatial dependence]{.important} possibly present in data
  is a foremost aspect of spatial statistics.

- Statistical [inference depends]{.important} heavily on the spatial
  [structure/geometry]{.important} of the observed spatial data.

| Geometry             | Branch               |
|:--------------------:|:--------------------:|
| Point-referrenced    | Geostatistics        |
|                      | Point patterns       |
| Areal units/polygons | Lattice/Areal models |
| Mixed                | Spatial Data Fusion  |

: {.striped}

## Areal Data {transition="fade-in-then-out"}

```{r}
#| label: fig-areal
#| fig-cap: Example of areal data.
#| crop: true

library(sf)
library(spdep)
library(ggplot2)
library(dplyr)

options(knitr.kable.NA = "")

bins_sturges <-
  function(x) diff(range(x)) / nclass.Sturges(x)

theme_set(theme_void() +
          theme(plot.background = element_rect(fill = "#FDF6E3",
                                               color = "#FDF6E3"),
                panel.background = element_rect(fill = "#FDF6E3",
                                                color = "#FDF6E3")))

dt_df <- readRDS("df.rds") |>
  arrange(id)

bord <- readRDS("border_counties.rds")

dt_df |>
  filter(!st_is(geometry, "POINT")) |>
  ggplot(data = _) +
  geom_sf(shape = 21, size = 3,
          color = 1) +
  geom_sf(data = bord, color = 1,
          fill = "transparent",
          lwd = .8)

```

## Point-refereced Data  {transition="fade-in-then-out"}

```{r}
#| label: fig-point
#| fig-cap: Example of point-referrenced data.
#| crop: true

dt_df |>
  filter(st_is(geometry, "POINT")) |>
  ggplot(data = _) +
  geom_sf(data = dt_df, color = "transparent",
          fill = "transparent") +
  geom_sf(shape = 19, size = 3,
          color = 1) +
  geom_sf(data = bord, color = 1,
          fill = "transparent",
          lwd = .8)
```

## Fused Data

```{r}
#| label: fig-fused
#| fig-cap: Example of fused data.
#| crop: true

dt_df |>
  ## filter(!st_is(geometry, "POINT")) |>
  ggplot(data = _) +
  geom_sf(shape = 19, size = 3,
          color = 1) +
  geom_sf(data = bord, color = 1,
          fill = "transparent",
          lwd = .8)

```

## General Spatial Model

The model below is flexible enough to analyze most spatial data structures
[@cressie1993statistics]

$$\{ Z(\mathbf{s}) \; : \; \mathbf{s} \in D \},$$ 

where [$D$ is an index set]{.important}.

- [Areal models]{.important2}: index set is [countable]{.important}.
  
- [Geostatistics]{.important2}: index set is a [continuum]{.important}.

:::{.notes}

- Challenges arise when working with data from different sources:
  
  - Change of support
  
  - Spatial misalignment
  
  - Data fusion itself.

:::

## Gaussian Process

- [Gaussian Process (GP)]{.important2}: a stochastic process such that all its
  [finite-dimensional marginal]{.important} distributions are multivariate
  [normal]{.important} distributions.
  
- [GP components]{.important2}: A [mean]{.important} and a [covariance
  functions]{.important} defined as, respectively, $\E[Z(\mathbf{s})] =
  m(\mathbf{s})$ and ${\rm Cov}(Z(\mathbf{s}_1), Z(\mathbf{s}_2)) = C(\mathbf{s}_1,
  \mathbf{s}_2)$.
  
- Common assumptions are [stationarity]{.important} and
  [isotropy]{.important}.

- [Importance in spatial statistics]{.important2}: predominant foundation of
  geostatistical modeling.
  
:::{.notes}

Loosely speaking, this means the GP has stationary mean, variance, and a
correlation function such that the correlation between two data points depends
solely on their distance.

The main reasons these models are not applied to areal data are:

1. Calculating distance between areal spatial units is non-trivial;
    
1. The commonly used areal models are computationally efficient.

:::


## Areal Data and the CAR Model

- $Z_k \mid Z_{-k} \sim \mathcal{N}\left (\frac{\psi} {m_k} \sum_{i \sim k} Z_i,
\frac{\tau^2}{m_k} \right)$

- Special case: [ICAR]{.important}.

- Extensions of the ICAR model, providing a measure of spatial dependence have
  been developed [@leroux2000estimation; @dean2001detecting].

- The directed acyclic graph auto-regressive (DAGAR) model [@datta2019spatial]
  proposes a new way to construct precision matrices using a DAG derived from
  the original adjacency matrix.

:::{.notes}

- CAR-like models are usually parametrized by the conditional precision.

- $m_k$ = # of neighbors

- $\psi$ spatial dependence parameter

- $i \sim k$ neighbors

:::

## Areal Models: Limitations

- [Out-of-sample predictions]{.important2}: [Non-trivial]{.important}, it may be
  necessary to refit the model.

- [Interpretability]{.important2}: Relationship between the [spatial dependence
  parameter]{.important} and correlation between neighbors is
  [counterintuitive]{.important}.

- [Heteroscedasticity]{.important2}: [Marginal SD]{.important} depend on the
  number of neighbors.

- [Extensions]{.important} for change of support and data fusion problems are
  [cumbersome]{.important} and there exists no consensus in the literature in
  how to approach such problems.

:::{.notes}

- spatial dependence parameter can be negative and the correlation with
  neighbors be positive.
  
- spatial dependence parameter very high and moderate correlation with neighbors

:::

## Fused Data

- [GP]{.important} at the point-referrenced level and a [stochastic integral at
  the areal level (AGP)]{.important} [@moraga2017geostatistical]:
  $$Z(\mathbf{s}_i) = \begin{cases} {\mathcal{A}(\mathbf{s}_i)}^{-1}
  \int_{\mathbf{s}_i} Z(\mathbf{s}) \dd \mathbf{s}, & \text{if }
  \mathcal{A}(\mathbf{s}_i) > 0, \\ Z(\mathbf{s}_i), & \; \text{otherwise,}
  \end{cases}$$

- [Covariance]{.important2} [@johnson2020dealing]:
  $$\mathrm{Cov}(Z(\mathbf{s}_i), Z(\mathbf{s}_j)) = {(\mathcal{A}(\mathbf{s}_i)
  \mathcal{A}(\mathbf{s}_j))}^{-1} \int_{\mathbf{s}_j} \int_{\mathbf{s}_i}
  C(\mathbf{x}, \mathbf{y}) \mathrm{d} \mathbf{x} \mathrm{d} \mathbf{y}$$
  
- [Arbitrary precision]{.important2}: The stochastic integrals are evaluated
  numerically and depend on a [user-defined grid]{.important}.

## Data Fusion Models: Limitations

- [Computing]{.important2}: Although satisfactory approximations exist, it
  becomes [computationally prohibitive for moderately large
  datasets]{.important}.

- [Approximations]{.important2}: Inferences may [drastically change]{.important}
  depending on the precision of the approximations.

- [Biases]{.important2}: It is hard to quantify the [impact of the
  discretizations on inferences]{.important} [@goncalves2018exact].

## Research Questions

- The main [research questions]{.important} we are interested in are:

  1. Can we propose a [model for spatial data that accomodates areal,
     point-referrenced, and fused data]{.important}?

  1. If so, is this model [competitive when compared to specialized
     models]{.important}?

- [Proposal]{.important2}: A GP defined on a [flexible index set]{.important}.

- [Main challenge]{.important2}: Defining a [valid correlation
  function]{.important}.

<!-- - The robustness of the method is showcased by two simulation studies and three -->
<!--   applications. -->

# Hausdorff--Gaussian Process (HGP) {.section_slide visibility="uncounted"}

## Distances between Sets

- [Metric space]{.important2}: $(D, d)$, where $D$ is a spatial region of
  interest.

- [Distance between a point and a set]{.important2}: $d(x, A) = \inf_{a \in A}
  d(x, a)$, where $d(x, y)$ is the distance between any two elements $x, y \in
  D$.

- [Directed Hausdorff distance]{.important2}: $${\vec h}(A, B) = \sup_{a \in A}
  d(a, B)$$

- [Hausdorff distance]{.important2}: $$h(A, B) = \max \left \{ \vec{h}(A, B),
  \vec{h}(B, A) \right \}$$

:::{.notes}

- [Symmetric Hausdorff distance]{.important2}: the greater of the two directed
  Hausdorff distances.

- Note that if $A$ and $B$ are both singletons, then $h(A, B) = d(A, B)$.

Meric Properties: (1) Symmetry: $d(x, y) = d(y, x)$; (2) Nonnegativeness: $d(x,
y) \geq 0$ and $d(x, x) = 0$; (3)Positiveness: $d(x, y) = 0 \implies x = y$; (4)
Triangle inequality: $d(x, y) \leq d(x, z) + d(z, y)$


:::


## Hausdorff Distance for Spatial Data Analysis

- [Study region]{.important2}: In spatial statistics, $D$ is tipically a [closed
  and bounded]{.important} subset of $\mathbb{R}^2$.

- In this context, the [Hausdorff distance is a metric]{.important}
  [@sendov2004hausdorff].

```{r}
#| label: haus-dist
#| fig-height: 6
#| layout-ncol: 3
#| file: fig-hausdorff.R
#| eval: true
```

:::{.notes}

- Metric on $D \setminus \varnothing$

- The Hausdorff distance ability to account for spatial units' [shapes, sizes
  and orientation]{.important}[@min2007extended] renders it an interesting tool
  to achieve our goals.

- Moreover, it can [distinguish]{.important} between [overlapping, nested, and
  disjointed regions]{.important}.

- In the figure: (1) The dashed lines denote the Hausdorff distances; (2) The
  infimum distance between to sets is zero for the three cases; (3) Distance
  between centroids is the same for the first two figures.

:::


## Beyond Traditional Modeling: The HGP

- [Isotropic stochastic process]{.important2}: $\{ Z(\mathbf{s}) \, : \,
  \mathbf{s} \in \mathcal{B}(D) \},$ where $D \subset \mathbb{R}^2$.

- [Flexible index set]{.important2}: $\mathcal{B}(D)$ contains all [closed and
  bounded subsets]{.important} of $D$.

- [The HGP]{.important2}: The stochastic process $Z(\cdot)$ is an HGP if:
  - It is a GP
  
  - Its [correlation function is a function of the Hausdorff
  distance]{.important} between sets (in our case, spatial units).

- This process is [suitable to analyze point-referrenced, areal, and mixed
  spatial data]{.important}.


:::{.notes}

- Ideally, we want bounded, compact, and non-empty sets for the Hausdorff
  distance to be a metric..

- In $\mathbb{R}^2$, a compact subset is bounded.

- empty is a subset of any set -> it is bounded bc a subset of a bounded set is
  bounded itself.

:::

## Structure of an HGP

The HGP, denoted $\mathrm{HGP}\{m(\mathbf{s}), v(\mathbf{s}), r(h)\}$,
formulation depends on three functions:

- The [mean]{.important} and [SD]{.important} functions, defined as
  $$m(\mathbf{s}) = \E[Z(\mathbf{s})], \quad \text{and} \quad v(\mathbf{s}) =
  \sqrt{\mathrm{Var}(Z(\mathbf{s}))},$$ respectively.

- [Correlation function]{.important2}: $r(h) =
  \mathrm{Cor}(Z(\mathbf{s}_1), Z(\mathbf{s}_2)),$ where $h$ denotes the
  [Hausdorff distance]{.important} between $\mathbf{s}_1, \mathbf{s}_2 \in
  \mathcal{B}(D)$.

- [Induced covariance function]{.important2}: $\mathrm{Cov}(Z(\mathbf{s}_1),
  Z(\mathbf{s}_2)) = v(\mathbf{s}_1) v(\mathbf{s}_2) r(h(\mathbf{s}_1,
  \mathbf{s}_2))$

:::{.notes}

- Mean and SD functions can be informed by covariates.

- The ensure the validity of the process, the function $r(\cdot)$ must be
  positive definite.

- Complex functional parametric space. 

- Inference is simplified (or possible) by assuming parametric forms to those
  functions.

:::


## The $v(\mathbf{s})$ function

A useful way to define this function is as follows: $$v(\mathbf{s}) = \exp \{
\alpha_0 + \alpha_1 w(\mathbf{s}) \},$$ where $w(\mathbf{s})$ is a covariate
available for any $\mathbf{s} \in \mathcal{B}(D)$.


- Special cases useful in practice:

    - [Homoscedastic]{.important2}: $w(\mathbf{s}) = 0$

    - [Data Fusion]{.important2}: $w(\mathbf{s}) =
      \mathbb{1}(\mathcal{A}(\mathbf{s}) > 0)$.
    
    - [Area dependent]{.important2}: $w(\mathbf{s}) = \mathcal{A}(\mathbf{s})$

- Although flexible, one has to be [careful]{.important} when choosing this
  function to ensure the [process validity]{.important} [@palacios2006non].


:::{.notes}

- The SD function allows the HGP to accommodate both [homoscedastic and
  heteroscedastic scenarios]{.important}.

:::

## Ensuring Validity: Correlation Functions for the HGP

For a valid process, its correlation function must satisfy the following
properties:
  
- [Diminish with increasing distance]{.important2}: $\lim_{h \to \infty}r(h) = 0$.
  
- [Bounded from above by 1]{.important2}: $r(0) = 1$.
  
- [Positive-definiteness]{.important2}: yields positive-definite correlation
  matrices for all its finite-dimensional marginal distributions.

- Unfortunately, functions that are guaranteed to be positive definite on
  $(\lVert \cdot \rVert_2, \mathbb{R}^2)$ are not necessarily positive definite
  on other metric spaces [@li2023inference].

## The Powered Exponential Correlation (PEC) Function

- [PEC function]{.important2}: $$r(h; \phi, \nu) = \exp\left \{ -
  \frac{h^{\nu}}{\phi^{\nu}}\right \},$$ where $\nu$ is a [smoothness
  parameter]{.important} and $\phi$ governs the range of the [spatial
  dependence]{.important}.

- [Parametrization]{.important2}: We reparametrize this function with $\rho =
  {\log(10)}^{1 / \nu} \phi$.

- [Interpretation]{.important2}: $\rho$ is the [distance]{.important} at which
  the [spatial correlation reduces to $0.10$]{.important}.

::: {.notes}

- explain $\rho$.

:::

## Visualizing the PEC function {visibility="uncounted"}

```{r}
#| label: pec-function
#| file: fig-pec.R
```

## Theoretical Foundation: Positive Definiteness of the PEC


:::{.callout-note appearance="simple" icon=false}

## Proposition

Let $h = h(\mathbf{s}, \mathbf{s}')$ be the Hausdorff distance between two
spatial units, denoted $\mathbf{s}, \mathbf{s}' \in \mathcal{B}(D)$, where $D
\subset \mathbb{R}^2$. The powered exponential correlation function $\exp \{ -
h^{\nu} / \phi^{\nu} \}$ is positive definite for $\nu \in (1/2, 1)$.

:::


- The proposition above [guarantees the validity]{.important} of the
  [HGP]{.important} equipped with a [PEC]{.important} function with $\nu \in
  (1/2, 1)$.

- The proof is based on embedding the Hausdorff distance into a high-dimensional
  $L_1$ normed Euclidean space, and using the fact that the exponential
  correlation function is positive definite on this space.

## Practical Validation: Empirical Assessment of Positive Definiteness

```{r}
#| label: psd-empirical
#| file: fig-psd.R
#| fig-align: center
```

:::{.notes}

- the graph displays the smallest eigenvalue of the correlation matrix induced
  by $\rho$ (x-axis) and $\nu$ (y-axis).
  
- These matrices are based on the two spatial applications we will discuss in
  the next chapter.
  
- The transparent regions indicate the regions of the parametric space where rho
  is smaller than 0.

:::

## HGP Recap

- [Flexibility]{.important2}: A process that handles [point-referrenced, areal,
  and mixed spatial data]{.important} by construction.

- [Hausdorff distance]{.important2}: Enables HGP's correlation function to
  account for the [shape, size, and orientation]{.important} of spatial objects.

- [Validity]{.important2}: Using a [PEC]{.important} function ensures the HGP is
  a [valid process]{.important}.

- [Next Up]{.important2}: Simulations and real-world applications will
  demonstrate the HGP's robustness.

```{mermaid}
flowchart LR
    A(Flexible index set) ==> B(GP)
    B ==> E(((HGP)))
    C(Hausdorff distance) ==> D(PEC)
    D ==> E
```

<!-- - [GP + PEC + Hausdorff distance]{.important2}: The correlation function as a -->
<!--   function of the asserts the shape, size and orientation of the spatial units -->
<!--   are taken into account. -->

<!-- - It is a [valid process]{.important} when using a [PEC]{.important} function. -->

<!-- - Th HGP [flexibility]{.important} render it suitable for complex problems in -->
<!--   spatial statistics. -->
  
<!-- - In the upcoming slides, we showcase its robustness through simulations and -->
<!--   applications to real data. -->

# Spatial modeling {.section_slide visibility="uncounted"}

## Outline {visibility="uncounted"}

- Spatial GLMM and Bayesian Inference

- Simulation study for:
  - Areal data
  - Fused data
  
- Applications
  - Areal data and disease mapping
  - Fused data and air pollution

## Notation

- [Set of spatial locations]{.important2}: $\mathcal{S} = \{ \mathbf{s}_1, \ldots, \mathbf{s}_n
  \}$, where $\mathbf{s}_i \in \mathcal{B}(D)$ and $D \subset \mathbb{R}^2$.

- [Response variable]{.important2}: $\mathbf{Y} = {(Y(\mathbf{s}_1), \ldots,
  Y(\mathbf{s}_n))}^\top$.

- [Covariates]{.important2}: $\mathbf{X} = (\mathbf{X}_1, \ldots, \mathbf{X}_p)$,
  where $\mathbf{X}_{j} = (x_{j1}, \ldots, x_{jn})^\top$ and $\mathbf{x}_i =
  (x_{1i}, \ldots, x_{pi})$.

- [Spatial random effects]{.important2}: $\mathbf{Z} = {(Z(\mathbf{s}_1), \ldots,
  Z(\mathbf{s}_n))}^\top$.

- [Density functions]{.important2} (for response and latent variables): $p(\cdot \mid \cdot)$

- [Prior and posterior distributions]{.important2}: $\pi(\cdot)$ and $\pi(\cdot
  \mid \cdot)$

:::{.notes}

- Realizations of random variables are represented by lowercase letters.

- Model paramers are greek letters.

:::

## Spatial GLMM

A generalized linear mixed model ([GLMM]{.important}) can be written as
$$\begin{aligned}
& Y(\mathbf{s}_i) \mid \mathbf{x}_i, z(\mathbf{s}_i) \overset{{\rm ind}}{\sim}
  f(\cdot \mid \mu_i, \omega) \\
& g(\mu_i) = \mathbf{x}_i \boldsymbol{\beta} +
  z(\mathbf{s}_i)  = \E[Y(\mathbf{s}_i) \mid \mathbf{x}_i,
  z(\mathbf{s}_i)].
\end{aligned}$$

- [Probability distribution]{.important2}: $f(\cdot)$

- [Link function]{.important2}: $g(\cdot)$

- [Conditional mean]{.important2}: $\mu_i = \E[Y(\mathbf{s}_i) \mid
  \mathbf{x}_i, z(\mathbf{s}_i)]$

- [Model parameters]{.important2}: $\theta = {\{\boldsymbol{\beta}^\top,
  \boldsymbol{\sigma}^\top, \delta^\top, \omega^\top \}}^\top$
  
- [Likelihood]{.important2}: $p(\mathbf{y} \mid \mathbf{z}, \theta) = \prod_{i =
  1}^n f(y(\mathbf{s}_i) \mid \mu_i, \omega)$

:::{.notes}

- Under a frequentist perspective, we consider the random effects to follow an
  HGP.
  
- For Bayesian inference, we use the HGP as a prior for the random effects.

- Response variable $Y$ at a spatial unit $s$ is modeled with an appropriate
  distribution (e.g., Poisson, Bernoulli).

- Covariates ($X$) and spatial random effects ($Z$) explain variation in the
  conditional mean ($\mu$).

- The HGP defines the spatial random effects ($Z$), capturing spatial
  correlation with the Hausdorff distance and a correlation function.

:::

## Bayesian Estimation

- [Priors]{.important2}: [$\mathbf{Z} \sim \mathrm{HGP}\{0, v(\cdot), r(\cdot)
  \}$]{.important}, $\boldsymbol{\beta} \sim \mathcal{N}(\mathbf{0}, 10^2
  \mathbf{I})$, $\rho \sim \mathrm{Exp}(a_\rho)$, $\nu = 0.7$.
  - Homoscedastic model ($v(\mathbf{s}) = \sigma$): $\sigma \sim t_{+}(3)$
  - Heteroscedastic model ($\log(v(\mathbf{s})) = \alpha_0 + \alpha_1
    w(\mathbf{s})$): $(\alpha_0, \alpha_1)^\top \sim \mathcal{N}(\mathbf{0}, 10^2
    \mathbf{I})$

- [Posterior]{.important2}: $\pi(\theta \mid \mathbf{y}, \mathbf{z}) \propto
  p(\mathbf{y} \mid \mathbf{z}, \theta) p(\mathbf{z} \mid \theta) \pi(\theta)$

- [MCMC sampler]{.important2}: No-U-Turn [@hoffman2014no].

- [Convergence assessment]{.important2}: traceplots and split-${\hat{R}}$
  [@vehtari2021rank].

:::{.notes}

- Point and interval estimates: median and percentiles ($0.025$
  and $0.975$) of the marginal MCMC samples.
  
- Parameters initialized by random sampling from their priors.

- Random effects initialized from a standard normal distribution.

- $a_\rho$ is chosen so that: $\mathbb{P}(\rho > U) = p_\rho$. In particular,
  $a_\rho = - \log(p_\rho) / \rho_0$.

- $\nu$ hard to be estimated.

:::

## Goodness-of-fit and Predictions

- [Goodness-of-fit criteria]{.important2}: DIC, WAIC, and LOOIC ([lower values
  indicate better fit]{.important})

  - $\Delta_G = G(\text{M}) - G(\text{HGP})$, where $G$ is a model
    comparison criterion and $M$ is a competing method.

- [Unobserved outcome at $m$ locations]{.important2}: $\mathbf{Y}^\ast =
  (y(\mathbf{s}^\ast_1), \ldots, y(\mathbf{s}^\ast_m))^\top$.

- [Posterior predictive distributions]{.important2}: $p(\mathbf{y}^{\ast} \mid
  \mathbf{y}) = \int p(\mathbf{y}^{\ast} \mid \mathbf{z}^{\ast}, \theta)
  p(\mathbf{z}^{\ast} \mid \mathbf{z}, \theta) \pi(\theta \mid \mathbf{y}) {\rm
  d} \theta$

- Monte Carlo samples from $p(\mathbf{y}^{\ast} \mid \mathbf{y})$ are obtained
  using the draws from the posterior $\pi(\theta \mid \mathbf{y})$

:::{.notes}

- $\Delta_G > 0$ favors the proposed method.

Predictions:

1. use the properties of GP and multivariate Normal distribution to obtain the
   closed-form distribution of the vector of spatial random effects
   $\mathbf{Z}^\ast$ [@diggle1998model];

2. sample $\mathbf{z}^\ast_{(b)}$ from the distribution derived in the previous
   step;

3. sample $\mathbf{y}^{\ast}_{(b)}$ from $p(\mathbf{y}^{\ast} \mid \theta_{(b)},
   \mathbf{z}^{\ast}_{(b)})$, where $\theta_{(b)}$ is the $b$-th MCMC sample of
   $\theta$.

:::


## Simulation Studies: Setup

- [Goal]{.important2}: Evaluate HGP's ability to adapt to different scenarios
  and [compare its performance to specialized models]{.important}.

- [200 simulated datasets]{.important2} for each combination of data generation
  process and scenario.

- [Estimation assessment]{.important2}: MAPE, RMSE, frequentist coverage of the credible
  interval (CP).
  
- [Predictions assessment]{.important2}: bias, RMSP, interval score [@gneiting2007strictly,
  IS], frequentist coverate of the prediction intervals (CPP).

:::{.notes}

> Overview: Emphasize the motivation behind the simulations – to demonstrate the
> HGP's ability to handle realistic scenarios and to compare its performance to
> established spatial models. Explain that simulations provide a controlled
> environment to assess model behavior.

- Simulated data on different maps and under different generating models. For
  each combination of map (data configuration) and generating model, we simulate
  200 datasets.

- Parameter used to simulate data were set to resemble the applications.

- IS: ${\rm IS}(y; l, u) = u - l + \frac{2}{\alpha} (l - y) \mathbb1}\{ y < l
  \} + \frac{2}{\alpha} (y - u) \mathbb1}\{ y > u \}$

- IS takes into account the width of the prediction intervals (PI) and a
  penalization factor proportional to how far a PI is from its target.

:::


## Simulation Studies: Scenarios

```{r}
#| label: simscen
#| file: fig-simscen.R
#| crop: true
#| layout-ncol: 2
```

## Simulation Study: Areal Data

- [Data model]{.important2}: Poisson GLMM, single covariate, log link function,
  and a spatial random effect.

- We fit Poisson GLMMs with a [homoscedastic HGP]{.important} prior on the
  random effect.

- [Assessment]{.important2}:
  - Parameter [estimation]{.important} when [generating data from
    HGP]{.important} random effects.
  - How good are the estimates of the [regression coefficient]{.important} under
    [random effect misspecification]{.important}?
  - [Goodness-of-fit comparison with DAGAR]{.important} priors on the random
    effect.

:::{.notes}

> Overview: Explain how areal data is simulated to mimic real-world
> complexities. Clearly distinguish between using the HGP for simulation and for
> fitting. Briefly outline the BYM model as a comparison point.

- Describe data generation processes: aggregated GPs, BYM models.

- DAGAR state-of-art specialized model

- Highlight the use of maps with different spatial configurations.

:::

## Areal Random Effects

- [Data Generation]{.important2}:

  - [Besag-York-Mollié [BYM, @besag1991bayesian]]{.important}: $\mathbf{Z} \sim
    \mathcal{N}(\mathbf{0}, \sigma^{2}((1 - \zeta) \mathbf{I} + \zeta
    \mathbf{Q}^{-})$, where $\mathbf{Q}$ is the precision matrix from the ICAR
    model and $\zeta$ is a mixing parameter.
  - [Aggregated GP (AGP)]{.important}: $Z(\mathbf{s}_i) =
    {\mathcal{A}(\mathbf{s}_i)}^{-1} \int_{\mathbf{s}_i} K(\mathbf{s}) \dd
    \mathbf{s}$, where $\{ K(\mathbf{s}) \, : \, \mathbf{s} \in D \}$ is a
    (point-level) zero-mean, second order stationary and isotropic GP.

- [Competing Method]{.important2}:

  - [DAGAR]{.important}: $\mathbf{Z} \sim \mathcal{N}(\mathbf{0}, \Lambda(\tau,
    \psi))$, where $\Lambda$ is a precision matrix, $\tau$ is the conditional
    precision, and $\psi$ measures spatial dependence.

:::{.notes}
DAGAR priors:
$$
\begin{aligned}
  \pi(\beta_0) & \propto 1 \\
  \beta_1 & \sim N(0, 1000^2) \\
  \tau & \sim Gamma(2, 1) \\
  \psi & \sim U(0, 1).
\end{aligned}
$$
- Precision matrix is defined based on the order of the observations and
adjacency matrix (and the two parameters)
:::

## Areal Simulation: Estimation

- [Generating data from HGP]{.important2}:

  - CP of the hardest parameter to estimate ($\rho$) was $92.5\%$ in the worst
    case scenario.
  - For all the other parameters, the [coverage was extremely close to the
    nominal level]{.important}.

- [Regression parameter under misspecification]{.important2}: 

  - Largest (worst) MAPE was $6.6\%$. 
  - CP of the credible interval [suggests reliable estimates]{.important}.

:::{.notes}

- Worst performance under scenario 3. This may be explained by the fact that we
  fit an homoscedastic model and the two generating processes are
  heteroscedastic under that scenario.

:::

## Areal Simulation: GOF


HGP [outperforms DAGAR]{.important} when simulating data from a AGP random
effect.


```{r}
#| label: agof
#| file: fig-agof.R
#| crop: true
#| fig-align: center
```

:::{.notes}

- For DIC we always win.

:::

## Simulation Study: Data Fusion

- [Data model]{.important2}: Gaussian GLMM, no covariates, identity link
  function, and a spatial random effect.

- We fit the models with a [heteroscedastic HGP]{.important} as prior on the
  random effect.

- [Competing method]{.important2}: [AGP~1~ and AGP~2~]{.important} priors on the
  random effect. The latter employes a finer grid/mesh resolution to approximate
  integrals numerically.

- [Parameters estimation]{.important2} when [generating data from
  HGP]{.important} random effects.

- [Model comparison]{.important2}: Predictions assessment.

:::{.notes}

> Overview: Highlight the unique aspect of data fusion simulations – working
> with different spatial data types. Explain the competing models and why
> they're relevant comparisons. Stress the importance of accurate predictions
> and uncertainty assessment in data fusion contexts.

- point-referrenced data have different SDs

- PC prior on $\tau$.

:::

## Competing Method: Meshes  {.section_slide visibility="uncounted"}

```{r}
#| label: meshes-sim
#| crop: true
#| fig-align: center
#| layout-ncol: 2
library(INLA)

meshes <- readRDS("meshes-sim.rds")
par(bg = fg)
plot(meshes[[3]], lwd = .25, col = bck,
     vertex.color = bck, edge.color = bck,
     border = bck)
plot(meshes[[4]], lwd = .25, col = bck,
     vertex.color = bck, edge.color = bck,
     border = bck)
## plot(meshes[[3]], lwd = .25, color = bck, border = bck)
## plot(meshes[[4]], lwd = .25, color = bck, border = bck)
rm(meshes)
```

## Competing Method: Further Details {visibility="uncounted"}

- The model employs a [Matérn covariance]{.important} function (at point level)
  with smoothness parameter fixed at 1. The other two parameters are the SD
  $\sigma$ and the practical range $\rho$. Both are analogous to the parameters
  with the same name in the HGP model.

- Inferences are conducted using the [INLA]{.important} [@rue2009approximate]
  and the stochastic partial differential equation [@lindgren2011explicit, SPDE]
  method.


## Data Fusion Simulation: Estimation

- The HGP inherits same [problems from geostatistical]{.important} models.

- There are no weakly consistent estimators for the variance and spatial
  dependence parameters  [@zhang2004inconsistent]
  
- Predictions are still optimal [@zhang2004inconsistent]

- The small scale variation parameter had a low coverage in the credible
  intervals ($79.5\%$ for scenario 2).
  
- The MAPE for the $\sigma$, $\sigma_a$, and $\rho$ parameters fluctuated around
  $10\%$ in both scenarios.

:::{.notes}

- Consistency and concentration of the posteiors Schervish.

- This limitations partially explains the estimation results.

:::

## Data Fusion Simulation: Prediction

- [Uncertainty of the predictions]{.important2}: The [HGP handles
  uncertainty]{.important} in its [predictions]{.important} better than the
  AGP~1~ model, even when the latter reflects the true data generation process.

<!-- - [Prediction Intervals]{.important2}: AGP~1~ models tend to have low coverage -->
<!--   in prediction intervals, underestimating potential variability. -->

- [HGP as an AGP Approximation]{.important2}: **The HGP delivers satisfactory
  approximations to an AGP model**.

- [HGP Advantages]{.important2}: The HGP offers potential [computational
  advantages]{.important} for large datasets while maintaining [clear parameter
  interpretation]{.important}.

:::{.notes}

- Point Estimates: AGP~2~ model consistently deliver point estimates (single
  value predictions) with minimal bias.

- The proposed methodology excelled in the predictions.

- AGP~1~ underestimating variability: evident in both correctly specified and
  misspecified cases.

- HGP avoids the need for defining a grid resolution used in numerical
  calculations.

:::

## Respiratory Disease Hospitalization

- [Sample units]{.important2}: 134 intermediate zones (IZ), where the $i$-th IZ
  is denoted $\mathbf{s}_i$.

- [Number of hospitalizations]{.important2}: $\mathbf{Y} = {(Y(\mathbf{s}_1),
  \ldots, Y(\mathbf{s}_n))}^\top$.

- [Expected number of hospitalizations]{.important2} based on the national age-
  and sex-standardized rates: $E_i$.

- [Percentage of people]{.important2} classified as [income
  deprived]{.important2}: $\mathbf{X}$.

$$\begin{aligned}
& (Y(\mathbf{s}_i) \mid x_i, z(\mathbf{s}_i)) \sim \text{Poisson}(E_i \mu_i) \\
& \log(\mu_i) = \beta_0 + x_i \beta_1 + z(\mathbf{s}_i)
\end{aligned}$$

:::{.notes}

- Data from the north portion of the river Clyde in the Great Glasgow and Clyde
  health board in Scotland.

- Assumption: Conditional on $\mathbf{Z}$, $\mathbf{Y}$ are mutually
  independent.

- Explain goals of the analysis--estimate risks adjusted for income deprivation,
  compare methods.

- $\mu_i$ is the expected SIR at region $i$.

- Outline the modeling choices (HGP, DAGAR, BYM), briefly mention priors.

:::

## Standardized Incidence Ratio (SIR)

```{r}
#| label: sir-scot
#| crop: true
#| fig-align: center

ggplot() +
  geom_sf(data = my_dt,
          aes(fill = SMR),
          color = fg,
          linewidth = .2) +
  scale_fill_distiller("SIR", palette = "Spectral") +
  theme_void() +
  theme(plot.background = element_rect(fill = bck,
                                       color = bck),
        panel.background = element_rect(fill = bck,
                                        color = bck),
        legend.position = c(.175, .2),
        legend.ticks = element_blank())
```

## Disease Mapping: GOF

|       | HGP    | DAGAR      | BYM        |
|:------|:------:|:----------:|:----------:|
| LOOIC | [1081.5]{.important} | 1084.0       | 1091.1 |
| WAIC  | 1038.7 |[1032.2]{.important} | 1041.1     |
| DIC   | [1048.8]{.important} | 1050.4     | 1050.6 |

: {.striped}

```{r}
#| label: sirfit
#| file: fig-scotsir.R
#| crop: true
#| fig-align: center
#| fig-height: 4.5
```

:::{.notes}


- Better fit in 2 out of 3 metrics

- Fitted values are similar among the three models

- Some regions with very low risks are shrunk toward a "regional mean"

:::

## Disease Mapping: Estimation {.center}

:::{.fw}

|     | HGP                        | DAGAR                      | BYM                        |
|:---:|:--------------------------:|:--------------------------:|:--------------------------:|
| $\beta_0$ | --0.208 (--0.265, --0.127) | --0.261 (--0.459, --0.140) | --0.219 (--0.257, --0.183) |
| $\beta_1$ | 0.325 (0.285, 0.366)       | 0.313 (0.258, 0.370)       | 0.326 (0.286, 0.367)       |
| $\sigma$  | 0.190 (0.154, 0.242)       | 0.300 (0.217, 0.489)       | 0.238 (0.176, 0.347)       |
| $\rho$    | 2.360 (0.140, 8.144)       |                            |                            |
| $\psi$    |                            | 0.435 (0.063, 0.830)       |                            |
| $\zeta$   |                            |                            | 0.428 (0.101, 0.811)       |

: {.striped}

:::

:::{.notes}

- median (95% CI)

- similar estimates for covariate

- HGP indicates weak spatial correlation

- DAGAR and BYM spatial dependence are not helpful as they indicate the spatial
  correlation goes from weak to strong (according to the CI)

:::

## Disease Mapping: Spatial Dependence

```{r}
#| label: scotrho
#| file: fig-scotrho.R
#| crop: true
#| fig-align: center
```

:::{.notes}

- HGP provides more insight into spatial dependence

- We could also plot the correlation function itself

:::

## Disease Mapping: Insights

- [HGP Advantages]{.important2}: The HGP provides a simpler and [more
  intuitive]{.important} understanding of [spatial dependence]{.important}
  compared to classical methods.

- [Assumptions]{.important2}: The HGP's core assumptions about spatial
  relationships differ from those used in specialized models for areal data.

- [Spatial Correlation]{.important2}: In the HGP, spatial correlation decreases
  as the Hausdorff distance between areas increases.

- [Specialized Models Complexity]{.important2}: Areal data models often rely on
  more complex spatial relationships based on detailed factors like shared
  borders and the number of neighboring units.


## Data Analysis: Air Pollution in Ventura and Los Angeles

::: {layout="[ 0.5, -0.05, 0.45 ]"}

::::{#first-column}

- [Point-referrenced data]{.important2} from 19 measurement stations available
  daily from 1999 to date;

- [Satellite-derived]{.important2} estimates (2010--2012) at 184 areal units.

- [PM~2.5~]{.important2}: $\mathbf{Y} = {(Y(\mathbf{s}_1), \ldots,
  Y(\mathbf{s}_n))}^\top$.

- [Model]{.important2}: $(Y(\mathbf{s}_i) \mid z(\mathbf{s}_i)) \sim
  \mathcal{N}(\beta_0 + z(\mathbf{s}_i), \tau^2)$

::::

::::{#second-column}

```{r}
#| label: pm25-map1
#| crop: true
#| fig-align: center

dt_df |>
  ggplot(data = _) +
  geom_sf(data = dt_df,
          aes(fill = pm25),
          size = 3,
          shape = 21,
          col = fg) +
  scale_fill_viridis_c(expression(PM[2.5]), option = "H") +
  geom_sf(data = bord, color = 1,
          fill = "transparent",
          lwd = .8) +
  theme(legend.position = "bottom")
```

::::

:::

:::{.notes}

- goals: (1); estimate model parameters using both sources. (2) use satellite
  data to help with interpolation.

- square areas (average size $\approx$ 101.95 km^2^)

- data fusion challenges

- adaptability of the hgp to different problems.

- Pm25 scale is micrometre per cubic meter: one one-millionth of a meter.

- conditional on $z$ the $y$s are mutually independent.

- Priors on random effects: AGP1 and 2; heteroscedastic HGP with different
  variances for areal and point-referrenced data.

:::

## Air Pollution: Meshes  {.section_slide visibility="uncounted"}

```{r}
#| label: meshes-lam
#| crop: true
#| fig-align: center
#| layout-ncol: 2
meshes <- readRDS("meshes-la.rds")
par(bg = fg)
plot(meshes[[1]], lwd = .25, col = bck,
     vertex.color = bck, edge.color = bck,
     border = bck)
plot(meshes[[2]], lwd = .25, col = bck,
     vertex.color = bck, edge.color = bck,
     border = bck)
rm(meshes)
```

## Air Pollution: GOF and 10-fold CV

:::{.xycenter}

|       | HGP    | AGP~1~ | AGP~2~ |
|:------|:------:|:------:|:------:|
| LOOIC | 505.1  | 746.7  | [--473.5]{.important} |
| WAIC  | 507.2  | 745.3  | [--876.2]{.important} |
| DIC   | 468.7  | 740.7  | [--819.3]{.important} |

: {.striped}

:::

## Air Pollution: GOF and 10-fold CV {transition="zoom-in slide-out" transition-speed="slow" visibility="uncounted"}

:::{.fw}

| Type    | Model  |       Bias |      RMSP |         IS |
|:-------|:-------|-------:|-------:|-------:|
| Overall | HGP    |    --0.019 | [0.214]{.important} |  [4.802]{.important} |
|         | AGP~1~ | [--0.005]{.important}|     0.333 |     15.114 |
|         | AGP~2~ |    --0.281 |     0.525 |     13.648 |
| Point   | HGP    | [--0.718]{.important}| [2.048]{.important} | [12.686]{.important} |
|         | AGP~1~ |    --3.298 |     3.829 |    111.838 |
|         | AGP~2~ |    --3.536 |     4.095 |     45.034 |
| Polygon | HGP    |  [0.003]{.important} | [0.111]{.important} |  [3.829]{.important} |
|         | AGP~1~ |      0.301 |     0.324 |      6.034 |
|         | AGP~2~ |      0.015 |     0.251 |     10.918 |

: {.striped}

:::

## Air Pollution: Estimation {.center}

:::{.fw}

|     | HGP                        | AGP~1~                     | AGP~2~                     |
|:---:|:--------------------------:|:--------------------------:|:--------------------------:|
| $\beta$    | 5.605 (4.688, 6.449) | 6.219 (2.160, 10.100)     | 6.187 (5.879, 6.478)       |
| $\rho$     | 1.383 (0.782, 2.36)  | 1.316 (0.514, 3.024)      | 0.063 (0.046, .083)        |
| $\sigma$   | 3.849 (2.921, 5.181) | 1.703 (0.960, 2.910)      | 2.399 (2.024, 2.837)       |
| $\tau$     | 0.178 (0.073, 0.312) | 1.394 (1.242, 1.563)      | 0.539 (0.394, 0.719)       |
| $\sigma_a$ | 1.241 (1.037, 1.505) |                           |                            |

: {.striped}

:::

:::{.notes}

- $\rho$ rescaled to 100s of km.

- staggering difference in estimates of the same model with different meshes.

:::

## Air Pollution: Change-of-Support


```{r}
#| label: lacos
#| file: fig-lacos.R
#| crop: true
#| fig-align: center
```

:::{.notes}

- Figure confirms what we learned from 10-fold CV and simulation studies.

- HGP allows to use data from different sources seamlessly

- No dependence on meshes/grids

- Apparently, a parsimonious compromise between the two meshes.

- Once again, the AGP seems highly dependend on the mesh and this is not
  highlighted in the literature.

:::

## Highlights

- [Flexibility \& Interpretability]{.important2}: Models [diverse spatial
  data]{.important} types and provides [meaningful spatial
  parameters]{.important}, regardless of unit size or shape.

- [Predictions]{.important2}: The HGP delivers [accurate predictions]{.important}

- [Areal Data]{.important2}: The model delivers valuable insights on the spatial
  dependence and accounts for sample units' size, shape, and orientation.

- [Data Fusion]{.important2}: The HGP [simplifies the modeling]{.important}
  process eliminating the need of a user-defined grid or mesh. Consequently,
  [avoids computationally intensive]{.important} numerical integrations with
  arbitrary precision, making inference seamless.
  

# Spatiotemporal modeling {.section_slide visibility="uncounted"}

## Tuberculosis in Brazil

- [TB in Context]{.important2}: Tuberculosis (TB) remains a major global health
  threat, second in infectious disease mortality only to COVID-19.
  
- [Brazilian TB Trends]{.important2}: Brazil's national TB incidence declined
  only slightly from 2006--2015. Rio Grande do Sul (RS) reported significantly
  higher incidence than the national average in 2021, with the eastern region
  even more affected.

- [Spatial Dependence]{.important2}: Studies demonstrate strong spatial
  dependence of TB infections (and co-infections) in Brazil, both nationwide and
  in specific cities. Time dependence has been largely overlooked in the
  literature.

- [Risk Factors]{.important2}: TB risk factors include densely populated areas,
  poverty, substance abuse, and incarceration.

:::{.notes}

- airborne infectious disease

- We focus on 54 municipalities in the Eastern part of the state (briefly
  explain why: zero-inflation, big n.)

:::

## Objectives

- [Reliable incidence estimates]{.important2}:
  - TB incidence across the study period, incorporating location-specific
    factors.
  - Smaller municipalities benefit from "borrowed strength" based on Hausdorff
    distance from neighbors, improving estimate reliability.
  - Results enable the calculation of SIRs to pinpoint high-risk areas.

- [Forecasts]{.important2}:
  - TB incidence rates one year ahead.
  - These predictions offer crucial insights for proactive public health planning.

<!-- ## TB over time -->
 
<!-- ```{r} -->
<!-- #| label: ttrend -->
<!-- #| file: fig-ttrend.R -->
<!-- #| crop: true -->
<!-- #| fig-align: center -->
<!-- ``` -->

## Model

- [Sample units]{.important2}: 54 municipalities, across 11 years (2011 to
  2021). We use 2022 to assess the quality of predictions.

- [Number of TB cases]{.important2}: $Y_t(\mathbf{s}_i) = Y(\mathbf{s}_i, t)$ at
  location $\mathbf{s}_i$ and time $t$.

- [Population]{.important2}: $P_t(\mathbf{s}_i)$.

- Five covariates and two way [interactions between presence of
  prison]{.important2} and continuous variables (except IDESE).

- The priors are the same as in the spatial setting. Here, we also placed a
  prior on $\nu$.

$$\begin{aligned}
& (Y_t(\mathbf{s}_i) \mid \mathbf{X}_{t}(\mathbf{s}_i), z_t(\mathbf{s}_i))
  \overset{{\rm ind}}{\sim}
  \text{Poisson}(P_t(\mathbf{s}_i) \mu_{it}) \\
& \log(\mu_{it}) = \beta_0 + \mathbf{X}^\top_{t}(\mathbf{s}_i) \beta + z_t(\mathbf{s}_i)
\end{aligned}$$

:::{.notes}

- $\mu_it$: rate

- A weakly informative Beta prior with mode at 0.75 and standard deviation
  around 0.22.

- Prior sensitivity using Importance Sampling and power-scaling.

:::

## Spatiotemporal Trend

```{r}
#| label: sptrend
#| file: fig-sptrend.R
#| crop: true
#| fig-align: center
```

:::{.notes}

- - Another COVARIATE: Presence of prison. Around 24\% of the municipalities had
  at least one prison. Incarcerated population was not available at a yearly
  basis.

- Cases per 100k inhabitants.

- 2015 and 2016: 2014 - World Cup; 2016 Olympic Games.

- 2019 COVID. 

- In general, we can see a spatial pattern and a decreasing trend.

:::


## Explanatory Variables

```{r}
#| label: sptcovars
#| file: fig-sptcovars.R
#| crop: true
#| fig-align: center
```

:::{.notes}

- pop. dens: log and then scaled.

- idese: scaled (IDESE is released yearly in RS and it is similar to IDH).

- homicide rates: EB then log-transformed then scaled

- HSDR: scaled.

- Transformations: Avoiding long-tails and highly influential observations

:::


## Random Effects

- No random effects

- [Unstructured]{.important2}: Random intercept per municipality (iid Normal)

- [Time dependent]{.important2}: $\mathrm{AR}(1)$

- [Spatial]{.important2}: Homoscedastic HGP

- [Separable spatiotemporal]{.important2}: $\mathrm{AR}(1)$ + Homoscedastic HGP, Multivariate
  $\mathrm{AR}(1)$ with HGP errors

- [Separable spatiotemporal and unstructured]{.important2}: Multivariate
  $\mathrm{AR}(1)$ with HGP errors + random intercept per municipality


:::{.notes}

- Model comparison criteria are the same as in the last chapter

- PC prior for the AR coefficient

- Best model was the more complex (by a lot)

- Compared results with analogous models having other spatial structures

:::

## Results: GOF and Predictive Performance

:::{.r-fit-text}

|       | LOOIC                | WAIC                 | DIC                  |RMSP      | IS        |
|:------|:------:|:------:|:------:|:------:|:------:|
| BYM   | 3606.1               | 3449.9               | 3505.4               |123.3     | 176.6     |
| DAGAR | 3520.9               | [3447.5]{.important} | [3443.6]{.important} | 22.4      | 88.8      |
| HGP   | [3516.1]{.important} | 3447.7               | 3450.4               |[21.1]{.important} | [87.8]{.important} |

: {.striped}

:::

:::{.notes}

- HGP vs. Specialized Models: When compared to specialized models like DAGAR,
  the HGP demonstrates highly competitive GOF performance.

- Minor Differences: While DAGAR slightly outperformed on some fit criteria, the
  overall goodness-of-fit differences between the HGP and DAGAR were minimal.

- Predictive Power: The HGP excels in predictive performance, outperforming
  competitors on both RMSP (point prediction accuracy) and IS (interval
  prediction accuracy).

:::

## Results: Relative Risks

:::{.fw}

| Parameter                    | Estimate          |
|:-----------------------------|:-----------------------------:|
| $\exp(\beta_1)$              | 2.34 (1.70, 3.19) |
| $\exp(\beta_2)$              | 1.33 (1.15, 1.56) |
| $\exp(\beta_3)$              | 1.03 (0.99, 1.07) |
| $\exp(\beta_4)$              | 0.97 (0.93, 1.00) |
| $\exp(\beta_5)$              | 0.99 (0.92, 1.07) |
| $\exp(\beta_2 + \beta_{21})$ | 1.75 (1.18, 2.52) |
| $\exp(\beta_3 + \beta_{31})$ | 2.25 (1.63, 3.09) |
| $\exp(\beta_4 + \beta_{41})$ | 2.51 (1.83, 3.46) |

: {.striped}

:::

:::{.notes}

- relative risk estimates derived from regression coefficients.

- (1): dummy for prison presence; (2) pop/km^2^; (3) homicides; (4) high school;
  (5) IDESE;

- Double-digit indices represent interactions between variables

- Municipalities with prisons have a 2.34 times higher average TB incidence,
  even when controlling for other factors.

- homicide rates and hsdr not important in prison-free municipalities but worsen
  the risk in municipalities with prisons.

:::


## Spatiotemporal Dependence

```{r}
#| label: sptcorr
#| file: fig-sptcorr.R
#| crop: true
#| fig-align: center
```

:::{.notes}

- Importance of spatiotemporal term

- Without the municipality random intercept we get even stronger spatial dependence.

- Not possible to make such graph for other areal models.

:::

## Small Municipalities

```{r}
#| label: sptshrink
#| file: fig-sptshrink.R
#| crop: true
#| fig-align: center
```

## Forecast

```{r}
#| label: sptpred
#| file: fig-sptpred.R
#| crop: true
#| fig-align: center
```

## Forecast {visibility="uncounted"}

```{r}
#| label: sptpop
#| file: fig-sptpop.R
#| crop: true
#| fig-align: center
```

## Highlights

- **Tailored an HGP extension for spatiotemporal disease mapping.**

- [Competitive]{.important2} with specialized models

- It helps to gain insights into spatiotemporal disease mapping through
  spatiotemporal correlation functions.

- More reliable [estimates of risk factors]{.important}

- [Out-of-sample predictions]{.important2} to inform public policies


# Closing remarks {.section_slide visibility="uncounted"}

## Conclusion

The [HGP offers a powerful and versatile model]{.important} for spatial
analysis. Advantages include:

- Common framework for diverse spatial data types.

- Competitive performance when compared to specialized models.
  
- Directly interpretable spatial parameters.

- Reliable and accurate predictions.

## Future work and Limitations

- [Extensions]{.important2}: 
  - non-Euclidean spaces
  - Big data

- [Limitations]{.important2}: 
  - Difficulties in obtaining spectral densities for correlation functions
  - Big "n" problem inherited from geostatistics
  - Unclear how to incorporate anisotropy 

---

### References {visibility="uncounted"}
